"""
Example usage of Deep Exploitation Orchestrator.

Run with: python -m services.snipers.deep_exploitation.example_usage
"""
import asyncio
import logging

from services.snipers.deep_exploitation import DeepExploitationOrchestrator

# Configure logging
logging.basicConfig(
    level=logging.INFO,
    format="%(asctime)s [%(levelname)s] %(name)s: %(message)s",
)


async def main():
    """Run deep exploitation attack example."""
    # Initialize orchestrator
    orchestrator = DeepExploitationOrchestrator()

    # Execute attack
    result = await orchestrator.run(
        campaign_id="TestCase1",
        target_url="http://localhost:8082/chat",
        max_iterations=10,
        success_threshold=0.8,
        success_scorers=["jailbreak"],
    )

    # Print results
    print("\n" + "=" * 60)
    print("DEEP EXPLOITATION RESULT")
    print("=" * 60)
    print(f"Success: {result.is_successful}")
    print(f"Total Score: {result.total_score:.2f}")
    print(f"Best Score: {result.best_score:.2f} (iteration {result.best_iteration})")
    print(f"Iterations Run: {result.iterations_run}")
    print(f"Final Chain: {result.final_chain}")

    if result.error:
        print(f"Error: {result.error}")

    if result.agent_output:
        print("\n--- Agent Output ---")
        print(result.agent_output[:500] + "..." if len(result.agent_output) > 500 else result.agent_output)

    print("=" * 60)


if __name__ == "__main__":
    asyncio.run(main())
