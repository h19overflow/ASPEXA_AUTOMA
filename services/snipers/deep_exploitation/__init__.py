"""
Deep Exploitation Module.

Purpose: Multi-iteration adaptive attack orchestration using deep agents
Role: LLM-driven orchestration with context isolation via subagent delegation
Dependencies: deepagents, existing adaptive_attack components

Architecture (Deep Agents Pattern):
    DeepExploitationOrchestrator (create_deep_agent)
    ├── Tools:
    │   └── execute_attack (Phase 1-2-3 pipeline)
    └── Subagents (via task() tool):
        ├── response-analyzer (rule-based defense pattern detection)
        ├── failure-analyzer (extracts actionable intelligence)
        ├── chain-discovery (LLM generates optimal chains)
        └── strategy-generator (LLM creates framing strategy)

Key Benefits:
    - Context isolation: Each subagent runs in isolated context
    - Dynamic flow: LLM decides what to analyze, not fixed graph edges
    - Token efficiency: Large subtask context compressed to single result
    - Flexible adaptation: Orchestrator can skip/reorder analysis as needed

Usage:
    from services.snipers.deep_exploitation import DeepExploitationOrchestrator

    orchestrator = DeepExploitationOrchestrator()
    result = await orchestrator.run(
        campaign_id="campaign_123",
        target_url="http://target/chat",
        max_iterations=5,
        success_threshold=0.8,
    )
"""
from services.snipers.deep_exploitation.orchestrator import (
    DeepExploitationOrchestrator,
    ExecutionResult,
)
from services.snipers.deep_exploitation.graph import (
    build_deep_exploitation_agent,
    compile_graph,
)
from services.snipers.deep_exploitation.subagents import get_all_subagents
from services.snipers.deep_exploitation.tools import get_orchestrator_tools
from services.snipers.deep_exploitation.decision_logger import (
    DecisionLogger,
    get_decision_logger,
    set_decision_logger,
)

# Legacy exports for backwards compatibility
from services.snipers.deep_exploitation.state import (
    DeepExploitationState,
    create_initial_state,
)

__all__ = [
    # Main API
    "DeepExploitationOrchestrator",
    "ExecutionResult",
    # Agent building
    "build_deep_exploitation_agent",
    "compile_graph",
    "get_all_subagents",
    "get_orchestrator_tools",
    # Decision logging
    "DecisionLogger",
    "get_decision_logger",
    "set_decision_logger",
    # Legacy (backwards compatibility)
    "DeepExploitationState",
    "create_initial_state",
]
