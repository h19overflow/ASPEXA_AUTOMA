"""Exploitation endpoint schemas."""
from pydantic import BaseModel, Field
from typing import List, Optional
from enum import Enum


class AttackModeAPI(str, Enum):
    """Attack execution mode for API."""
    GUIDED = "guided"
    MANUAL = "manual"
    SWEEP = "sweep"


class ProbeCategoryAPI(str, Enum):
    """Probe categories for sweep mode."""
    JAILBREAK = "jailbreak"
    PROMPT_INJECTION = "prompt_injection"
    ENCODING = "encoding"
    DATA_EXTRACTION = "data_extraction"
    TOOL_EXPLOITATION = "tool_exploitation"


class ExploitStartRequest(BaseModel):
    """Request to start exploitation (legacy endpoint)."""
    campaign_id: str
    target_url: Optional[str] = None
    probe_name: Optional[str] = None


class ExploitStreamRequest(BaseModel):
    """Request for streaming exploit execution (multi-mode support)."""
    target_url: str = Field(..., description="Target endpoint URL")
    mode: AttackModeAPI = Field(..., description="Attack mode: guided, manual, or sweep")
    campaign_id: Optional[str] = Field(None, description="Optional campaign for persistence/intel")
    # Manual mode
    custom_payload: Optional[str] = Field(None, description="Custom payload for manual mode")
    converters: Optional[List[str]] = Field(None, description="Converters to apply in order")
    # Sweep mode
    categories: Optional[List[ProbeCategoryAPI]] = Field(None, description="Probe categories for sweep")
    probes_per_category: int = Field(5, ge=1, le=20, description="Max probes per category")
    # Guided mode
    probe_name: Optional[str] = Field(None, description="Specific probe for guided mode")
    # Config
    require_plan_approval: bool = Field(True, description="Require human approval before execution")
