"""Exploitation router - HTTP endpoints for Snipers service."""
from fastapi import APIRouter
from typing import Any, Dict

from services.snipers.entrypoint import execute_exploit
from services.api_gateway.schemas import ExploitStartRequest

router = APIRouter(prefix="/exploit", tags=["exploitation"])


@router.post("/start")
async def start_exploit(request: ExploitStartRequest) -> Dict[str, Any]:
    """Start exploitation for a campaign.

    Requires recon and garak scans to be completed first.
    Loads intelligence from S3 automatically.

    Returns:
        Exploit results with scan_id
    """
    result = await execute_exploit(
        campaign_id=request.campaign_id,
        target_url=request.target_url,
        probe_name=request.probe_name,
    )
    return result
