<?xml version="1.0" encoding="utf-8"?><testsuites name="pytest tests"><testsuite name="pytest" errors="1" failures="0" skipped="0" tests="1" time="2.484" timestamp="2025-12-06T22:27:25.702892+08:00" hostname="Adonis2"><testcase classname="" name="tests.unit.services.swarm.agents.test_agent_architecture" time="0.000"><error message="collection failure">tests\unit\services\swarm\agents\test_agent_architecture.py:16: in &lt;module&gt;
    from services.swarm.agents.base_agent import BaseAgent, ProbePlan
        Any        = typing.Any
        Dict       = typing.Dict
        List       = typing.List
        __builtins__ = &lt;builtins&gt;
        __cached__ = 'C:\\Users\\User\\Projects\\Aspexa_Automa\\tests\\unit\\services\\swarm\\agents\\__pycache__\\test_agent_architecture.cpython-313.pyc'
        __doc__    = ('\n'
 'Test suite for new agent architecture.\n'
 '\n'
 'Focus:\n'
 '1. Import tests - verify all modules can be imported\n'
 '2. Registry tests - verify get_agent() factory works\n'
 '3. Agent instantiation - verify each agent initializes\n'
 '4. Interface compliance - verify all agents implement BaseAgent interface\n'
 '5. Schema validation - verify ProbePlan schema works\n')
        __file__   = 'C:\\Users\\User\\Projects\\Aspexa_Automa\\tests\\unit\\services\\swarm\\agents\\test_agent_architecture.py'
        __loader__ = &lt;_pytest.assertion.rewrite.AssertionRewritingHook object at 0x00000173C1997E00&gt;
        __name__   = 'swarm.agents.test_agent_architecture'
        __package__ = 'swarm.agents'
        __spec__   = ModuleSpec(name='swarm.agents.test_agent_architecture', loader=&lt;_pytest.assertion.rewrite.AssertionRewritingHook object at 0x00000173C1997E00&gt;, origin='C:\\Users\\User\\Projects\\Aspexa_Automa\\tests\\unit\\services\\swarm\\agents\\test_agent_architecture.py')
        pytest     = &lt;module 'pytest' from 'C:\\Users\\User\\AppData\\Local\\Programs\\Python\\Python313\\Lib\\site-packages\\pytest\\__init__.py'&gt;
services\swarm\__init__.py:17: in &lt;module&gt;
    from .entrypoint import execute_scan_streaming
        __builtins__ = &lt;builtins&gt;
        __cached__ = 'C:\\Users\\User\\Projects\\Aspexa_Automa\\services\\swarm\\__pycache__\\__init__.cpython-313.pyc'
        __doc__    = ('Swarm scanning service - Intelligent security scanning for LLM '
 'applications.\n'
 '\n'
 'Purpose: Executes targeted security scans against LLM agents using Garak '
 'probes\n'
 'Role: Trinity agents (SQL, AUTH, JAILBREAK) analyze recon and execute '
 'vulnerability scans\n'
 'Dependencies: garak, langchain, libs.contracts.scanning, libs.events\n'
 '\n'
 'Architecture:\n'
 '    - agents/: LangChain-based intelligent agents for scan orchestration\n'
 '    - core/: Configuration, schemas, utilities, and event consumers\n'
 '    - garak_scanner/: Garak probe integration and result parsing\n'
 '    - persistence/: S3 storage for scan results\n'
 '\n'
 'Public API:\n'
 '    - execute_scan_streaming: Async streaming scan with real-time events\n')
        __file__   = 'C:\\Users\\User\\Projects\\Aspexa_Automa\\services\\swarm\\__init__.py'
        __loader__ = &lt;_frozen_importlib_external.SourceFileLoader object at 0x000001738D15DF10&gt;
        __name__   = 'services.swarm'
        __package__ = 'services.swarm'
        __path__   = ['C:\\Users\\User\\Projects\\Aspexa_Automa\\services\\swarm']
        __spec__   = ModuleSpec(name='services.swarm', loader=&lt;_frozen_importlib_external.SourceFileLoader object at 0x000001738D15DF10&gt;, origin='C:\\Users\\User\\Projects\\Aspexa_Automa\\services\\swarm\\__init__.py', submodule_search_locations=['C:\\Users\\User\\Projects\\Aspexa_Automa\\services\\swarm'])
services\swarm\entrypoint.py:16: in &lt;module&gt;
    from services.swarm.agents.base import run_planning_agent
        Any        = typing.Any
        AsyncGenerator = typing.AsyncGenerator
        Dict       = typing.Dict
        List       = typing.List
        Optional   = typing.Optional
        ReconBlueprint = &lt;class 'libs.contracts.recon.ReconBlueprint'&gt;
        ScanJobDispatch = &lt;class 'libs.contracts.scanning.ScanJobDispatch'&gt;
        __builtins__ = &lt;builtins&gt;
        __cached__ = 'C:\\Users\\User\\Projects\\Aspexa_Automa\\services\\swarm\\__pycache__\\entrypoint.cpython-313.pyc'
        __doc__    = ('HTTP entrypoint for Swarm scanning service.\n'
 '\n'
 'Exposes scanning logic for direct invocation via API gateway.\n'
 '\n'
 'Architecture:\n'
 '- Phase 1 (Planning): Agent analyzes target and produces ScanPlan (~2-3s)\n'
 '- Phase 2 (Execution): Scanner executes plan with real-time streaming\n')
        __file__   = 'C:\\Users\\User\\Projects\\Aspexa_Automa\\services\\swarm\\entrypoint.py'
        __loader__ = &lt;_frozen_importlib_external.SourceFileLoader object at 0x000001738D15E1B0&gt;
        __name__   = 'services.swarm.entrypoint'
        __package__ = 'services.swarm'
        __spec__   = ModuleSpec(name='services.swarm.entrypoint', loader=&lt;_frozen_importlib_external.SourceFileLoader object at 0x000001738D15E1B0&gt;, origin='C:\\Users\\User\\Projects\\Aspexa_Automa\\services\\swarm\\entrypoint.py')
        datetime   = &lt;class 'datetime.datetime'&gt;
        logging    = &lt;module 'logging' from 'C:\\Users\\User\\AppData\\Local\\Programs\\Python\\Python313\\Lib\\logging\\__init__.py'&gt;
        observe    = &lt;bound method LangfuseDecorator.observe of &lt;langfuse._client.observe.LangfuseDecorator object at 0x000001738CF33620&gt;&gt;
        timezone   = &lt;class 'datetime.timezone'&gt;
services\swarm\agents\__init__.py:12: in &lt;module&gt;
    from .sql import SQLAgent
        BaseAgent  = &lt;class 'services.swarm.agents.base_agent.BaseAgent'&gt;
        Dict       = typing.Dict
        ProbePlan  = &lt;class 'services.swarm.agents.base_agent.ProbePlan'&gt;
        Type       = typing.Type
        __annotations__ = {}
        __builtins__ = &lt;builtins&gt;
        __cached__ = 'C:\\Users\\User\\Projects\\Aspexa_Automa\\services\\swarm\\agents\\__pycache__\\__init__.cpython-313.pyc'
        __doc__    = ('\n'
 'Agent system for intelligent security scanning.\n'
 '\n'
 'Purpose: LangChain agents for analyzing recon intelligence and executing '
 'targeted scans\n'
 'Role: Coordinates scanning with intelligent decision-making\n'
 'Dependencies: langchain, langchain_google_genai, scanner, config\n')
        __file__   = 'C:\\Users\\User\\Projects\\Aspexa_Automa\\services\\swarm\\agents\\__init__.py'
        __loader__ = &lt;_frozen_importlib_external.SourceFileLoader object at 0x000001738D23FDD0&gt;
        __name__   = 'services.swarm.agents'
        __package__ = 'services.swarm.agents'
        __path__   = ['C:\\Users\\User\\Projects\\Aspexa_Automa\\services\\swarm\\agents']
        __spec__   = ModuleSpec(name='services.swarm.agents', loader=&lt;_frozen_importlib_external.SourceFileLoader object at 0x000001738D23FDD0&gt;, origin='C:\\Users\\User\\Projects\\Aspexa_Automa\\services\\swarm\\agents\\__init__.py', submodule_search_locations=['C:\\Users\\User\\Projects\\Aspexa_Automa\\services\\swarm\\agents'])
        base_agent = &lt;module 'services.swarm.agents.base_agent' from 'C:\\Users\\User\\Projects\\Aspexa_Automa\\services\\swarm\\agents\\base_agent.py'&gt;
services\swarm\agents\sql\__init__.py:7: in &lt;module&gt;
    from .sql_agent import SQLAgent
        __builtins__ = &lt;builtins&gt;
        __cached__ = 'C:\\Users\\User\\Projects\\Aspexa_Automa\\services\\swarm\\agents\\sql\\__pycache__\\__init__.cpython-313.pyc'
        __doc__    = ('\n'
 'SQL Agent module for data surface vulnerability scanning.\n'
 '\n'
 'Purpose: Export SQL agent components\n'
 'Dependencies: sql_agent.py, sql_prompt.py, sql_probes.py, sql_tools.py\n')
        __file__   = 'C:\\Users\\User\\Projects\\Aspexa_Automa\\services\\swarm\\agents\\sql\\__init__.py'
        __loader__ = &lt;_frozen_importlib_external.SourceFileLoader object at 0x00000173EA94FB30&gt;
        __name__   = 'services.swarm.agents.sql'
        __package__ = 'services.swarm.agents.sql'
        __path__   = ['C:\\Users\\User\\Projects\\Aspexa_Automa\\services\\swarm\\agents\\sql']
        __spec__   = ModuleSpec(name='services.swarm.agents.sql', loader=&lt;_frozen_importlib_external.SourceFileLoader object at 0x00000173EA94FB30&gt;, origin='C:\\Users\\User\\Projects\\Aspexa_Automa\\services\\swarm\\agents\\sql\\__init__.py', submodule_search_locations=['C:\\Users\\User\\Projects\\Aspexa_Automa\\services\\swarm\\agents\\sql'])
services\swarm\agents\sql\sql_agent.py:12: in &lt;module&gt;
    from langchain.agents import create_agent
        Any        = typing.Any
        Dict       = typing.Dict
        List       = typing.List
        __builtins__ = &lt;builtins&gt;
        __cached__ = 'C:\\Users\\User\\Projects\\Aspexa_Automa\\services\\swarm\\agents\\sql\\__pycache__\\sql_agent.cpython-313.pyc'
        __doc__    = ('\n'
 'SQL Agent for data surface vulnerability scanning.\n'
 '\n'
 'Purpose: Plan and execute SQL/XSS/data extraction scans\n'
 'Dependencies: langchain&gt;=1.0, langchain-google-genai\n'
 'Used by: services.swarm.agents registry\n')
        __file__   = 'C:\\Users\\User\\Projects\\Aspexa_Automa\\services\\swarm\\agents\\sql\\sql_agent.py'
        __loader__ = &lt;_frozen_importlib_external.SourceFileLoader object at 0x00000173EA94E1B0&gt;
        __name__   = 'services.swarm.agents.sql.sql_agent'
        __package__ = 'services.swarm.agents.sql'
        __spec__   = ModuleSpec(name='services.swarm.agents.sql.sql_agent', loader=&lt;_frozen_importlib_external.SourceFileLoader object at 0x00000173EA94E1B0&gt;, origin='C:\\Users\\User\\Projects\\Aspexa_Automa\\services\\swarm\\agents\\sql\\sql_agent.py')
        json       = &lt;module 'json' from 'C:\\Users\\User\\AppData\\Local\\Programs\\Python\\Python313\\Lib\\json\\__init__.py'&gt;
        logging    = &lt;module 'logging' from 'C:\\Users\\User\\AppData\\Local\\Programs\\Python\\Python313\\Lib\\logging\\__init__.py'&gt;
..\..\AppData\Local\Programs\Python\Python313\Lib\site-packages\langchain\agents\__init__.py:3: in &lt;module&gt;
    from langchain.agents.factory import create_agent
        __builtins__ = &lt;builtins&gt;
        __cached__ = 'C:\\Users\\User\\AppData\\Local\\Programs\\Python\\Python313\\Lib\\site-packages\\langchain\\agents\\__pycache__\\__init__.cpython-313.pyc'
        __doc__    = ('Entrypoint to building '
 '[Agents](https://docs.langchain.com/oss/python/langchain/agents) with '
 'LangChain.')
        __file__   = 'C:\\Users\\User\\AppData\\Local\\Programs\\Python\\Python313\\Lib\\site-packages\\langchain\\agents\\__init__.py'
        __loader__ = &lt;_frozen_importlib_external.SourceFileLoader object at 0x00000173EA94D190&gt;
        __name__   = 'langchain.agents'
        __package__ = 'langchain.agents'
        __path__   = ['C:\\Users\\User\\AppData\\Local\\Programs\\Python\\Python313\\Lib\\site-packages\\langchain\\agents']
        __spec__   = ModuleSpec(name='langchain.agents', loader=&lt;_frozen_importlib_external.SourceFileLoader object at 0x00000173EA94D190&gt;, origin='C:\\Users\\User\\AppData\\Local\\Programs\\Python\\Python313\\Lib\\site-packages\\langchain\\agents\\__init__.py', submodule_search_locations=['C:\\Users\\User\\AppData\\Local\\Programs\\Python\\Python313\\Lib\\site-packages\\langchain\\agents'])
..\..\AppData\Local\Programs\Python\Python313\Lib\site-packages\langchain\agents\factory.py:16: in &lt;module&gt;
    from langchain_core.language_models.chat_models import BaseChatModel
        Annotated  = typing.Annotated
        Any        = typing.Any
        TYPE_CHECKING = False
        __builtins__ = &lt;builtins&gt;
        __cached__ = 'C:\\Users\\User\\AppData\\Local\\Programs\\Python\\Python313\\Lib\\site-packages\\langchain\\agents\\__pycache__\\factory.cpython-313.pyc'
        __doc__    = 'Agent factory for creating agents with middleware support.'
        __file__   = 'C:\\Users\\User\\AppData\\Local\\Programs\\Python\\Python313\\Lib\\site-packages\\langchain\\agents\\factory.py'
        __loader__ = &lt;_frozen_importlib_external.SourceFileLoader object at 0x00000173EA94DAF0&gt;
        __name__   = 'langchain.agents.factory'
        __package__ = 'langchain.agents'
        __spec__   = ModuleSpec(name='langchain.agents.factory', loader=&lt;_frozen_importlib_external.SourceFileLoader object at 0x00000173EA94DAF0&gt;, origin='C:\\Users\\User\\AppData\\Local\\Programs\\Python\\Python313\\Lib\\site-packages\\langchain\\agents\\factory.py')
        annotations = _Feature((3, 7, 0, 'beta', 1), None, 16777216)
        cast       = &lt;function cast at 0x00000173C0F11DA0&gt;
        get_args   = &lt;function get_args at 0x00000173C0F120C0&gt;
        get_origin = &lt;function get_origin at 0x00000173C0F12020&gt;
        get_type_hints = &lt;function get_type_hints at 0x00000173C0F11EE0&gt;
        itertools  = &lt;module 'itertools' (built-in)&gt;
..\..\AppData\Local\Programs\Python\Python313\Lib\site-packages\langchain_core\language_models\chat_models.py:31: in &lt;module&gt;
    from langchain_core.language_models.base import (
        ABC        = &lt;class 'abc.ABC'&gt;
        Any        = typing.Any
        AsyncCallbackManager = &lt;class 'langchain_core.callbacks.manager.AsyncCallbackManager'&gt;
        AsyncCallbackManagerForLLMRun = &lt;class 'langchain_core.callbacks.manager.AsyncCallbackManagerForLLMRun'&gt;
        AsyncIterator = &lt;class 'collections.abc.AsyncIterator'&gt;
        BaseCache  = &lt;class 'langchain_core.caches.BaseCache'&gt;
        BaseModel  = &lt;class 'pydantic.main.BaseModel'&gt;
        Callable   = &lt;class 'collections.abc.Callable'&gt;
        CallbackManager = &lt;class 'langchain_core.callbacks.manager.CallbackManager'&gt;
        CallbackManagerForLLMRun = &lt;class 'langchain_core.callbacks.manager.CallbackManagerForLLMRun'&gt;
        Callbacks  = list[langchain_core.callbacks.base.BaseCallbackHandler] | langchain_core.callbacks.base.BaseCallbackManager | None
        ConfigDict = &lt;class 'pydantic.config.ConfigDict'&gt;
        Field      = &lt;function Field at 0x00000173C687E980&gt;
        Iterator   = &lt;class 'collections.abc.Iterator'&gt;
        Literal    = typing.Literal
        Sequence   = &lt;class 'collections.abc.Sequence'&gt;
        TYPE_CHECKING = False
        __builtins__ = &lt;builtins&gt;
        __cached__ = 'C:\\Users\\User\\AppData\\Local\\Programs\\Python\\Python313\\Lib\\site-packages\\langchain_core\\language_models\\__pycache__\\chat_models.cpython-313.pyc'
        __doc__    = 'Chat models for conversational AI.'
        __file__   = 'C:\\Users\\User\\AppData\\Local\\Programs\\Python\\Python313\\Lib\\site-packages\\langchain_core\\language_models\\chat_models.py'
        __loader__ = &lt;_frozen_importlib_external.SourceFileLoader object at 0x00000173EA94CE30&gt;
        __name__   = 'langchain_core.language_models.chat_models'
        __package__ = 'langchain_core.language_models'
        __spec__   = ModuleSpec(name='langchain_core.language_models.chat_models', loader=&lt;_frozen_importlib_external.SourceFileLoader object at 0x00000173EA94CE30&gt;, origin='C:\\Users\\User\\AppData\\Local\\Programs\\Python\\Python313\\Lib\\site-packages\\langchain_core\\language_models\\chat_models.py')
        _normalize_messages = &lt;function _normalize_messages at 0x00000173EAD91300&gt;
        _update_message_content_to_blocks = &lt;function _update_message_content_to_blocks at 0x00000173EAD90FE0&gt;
        abstractmethod = &lt;function abstractmethod at 0x00000173C08CB6A0&gt;
        annotations = _Feature((3, 7, 0, 'beta', 1), None, 16777216)
        asyncio    = &lt;module 'asyncio' from 'C:\\Users\\User\\AppData\\Local\\Programs\\Python\\Python313\\Lib\\asyncio\\__init__.py'&gt;
        cached_property = &lt;class 'functools.cached_property'&gt;
        cast       = &lt;function cast at 0x00000173C0F11DA0&gt;
        get_llm_cache = &lt;function get_llm_cache at 0x00000173EADB4EA0&gt;
        inspect    = &lt;module 'inspect' from 'C:\\Users\\User\\AppData\\Local\\Programs\\Python\\Python313\\Lib\\inspect.py'&gt;
        itemgetter = &lt;class 'operator.itemgetter'&gt;
        json       = &lt;module 'json' from 'C:\\Users\\User\\AppData\\Local\\Programs\\Python\\Python313\\Lib\\json\\__init__.py'&gt;
        override   = &lt;function override at 0x00000173C0F29080&gt;
        typing     = &lt;module 'typing' from 'C:\\Users\\User\\AppData\\Local\\Programs\\Python\\Python313\\Lib\\typing.py'&gt;
..\..\AppData\Local\Programs\Python\Python313\Lib\site-packages\langchain_core\language_models\base.py:30: in &lt;module&gt;
    from langchain_core.prompt_values import (
        ABC        = &lt;class 'abc.ABC'&gt;
        AIMessage  = &lt;class 'langchain_core.messages.ai.AIMessage'&gt;
        Any        = typing.Any
        AnyMessage = typing.Annotated[typing.Union[typing.Annotated[langchain_core.messages.ai.AIMessage, Tag(tag='ai')], typing.Annotated[langchain_core.messages.human.HumanMessage, Tag(tag='human')], typing.Annotated[langchain_core.messages.chat.ChatMessage, Tag(tag='chat')], typing.Annotated[langchain_core.messages.system.SystemMessage, Tag(tag='system')], typing.Annotated[langchain_core.messages.function.FunctionMessage, Tag(tag='function')], typing.Annotated[langchain_core.messages.tool.ToolMessage, Tag(tag='tool')], typing.Annotated[langchain_core.messages.ai.AIMessageChunk, Tag(tag='AIMessageChunk')], typing.Annotated[langchain_core.messages.human.HumanMessageChunk, Tag(tag='HumanMessageChunk')], typing.Annotated[langchain_core.messages.chat.ChatMessageChunk, Tag(tag='ChatMessageChunk')], typing.Annotated[langchain_core.messages.system.SystemMessageChunk, Tag(tag='SystemMessageChunk')], typing.Annotated[langchain_core.messages.function.FunctionMessageChunk, Tag(tag='FunctionMessageChunk')], typing.Annotated[langchain_core.messages.tool.ToolMessageChunk, Tag(tag='ToolMessageChunk')]], FieldInfo(annotation=NoneType, required=True, discriminator=Discriminator(discriminator=&lt;function _get_type at 0x00000173EADB7D80&gt;, custom_error_type=None, custom_error_message=None, custom_error_context=None))]
        BaseCache  = &lt;class 'langchain_core.caches.BaseCache'&gt;
        BaseMessage = &lt;class 'langchain_core.messages.base.BaseMessage'&gt;
        BaseModel  = &lt;class 'pydantic.main.BaseModel'&gt;
        Callable   = &lt;class 'collections.abc.Callable'&gt;
        Callbacks  = list[langchain_core.callbacks.base.BaseCallbackHandler] | langchain_core.callbacks.base.BaseCallbackManager | None
        ConfigDict = &lt;class 'pydantic.config.ConfigDict'&gt;
        Field      = &lt;function Field at 0x00000173C687E980&gt;
        Literal    = typing.Literal
        Mapping    = &lt;class 'collections.abc.Mapping'&gt;
        MessageLikeRepresentation = langchain_core.messages.base.BaseMessage | list[str] | tuple[str, str] | str | dict[str, typing.Any]
        Sequence   = &lt;class 'collections.abc.Sequence'&gt;
        TYPE_CHECKING = False
        TypeAlias  = typing.TypeAlias
        TypeVar    = &lt;class 'typing.TypeVar'&gt;
        TypedDict  = typing_extensions.TypedDict
        __builtins__ = &lt;builtins&gt;
        __cached__ = 'C:\\Users\\User\\AppData\\Local\\Programs\\Python\\Python313\\Lib\\site-packages\\langchain_core\\language_models\\__pycache__\\base.cpython-313.pyc'
        __doc__    = 'Base language models class.'
        __file__   = 'C:\\Users\\User\\AppData\\Local\\Programs\\Python\\Python313\\Lib\\site-packages\\langchain_core\\language_models\\base.py'
        __loader__ = &lt;_frozen_importlib_external.SourceFileLoader object at 0x00000173EA8D7170&gt;
        __name__   = 'langchain_core.language_models.base'
        __package__ = 'langchain_core.language_models'
        __spec__   = ModuleSpec(name='langchain_core.language_models.base', loader=&lt;_frozen_importlib_external.SourceFileLoader object at 0x00000173EA8D7170&gt;, origin='C:\\Users\\User\\AppData\\Local\\Programs\\Python\\Python313\\Lib\\site-packages\\langchain_core\\language_models\\base.py')
        abstractmethod = &lt;function abstractmethod at 0x00000173C08CB6A0&gt;
        annotations = _Feature((3, 7, 0, 'beta', 1), None, 16777216)
        cache      = &lt;function cache at 0x00000173C0AD7240&gt;
        field_validator = &lt;function field_validator at 0x00000173C676EDE0&gt;
        get_buffer_string = &lt;function get_buffer_string at 0x00000173EAD90CC0&gt;
        get_verbose = &lt;function get_verbose at 0x00000173EAE2F240&gt;
        override   = &lt;function override at 0x00000173C0F29080&gt;
        warnings   = &lt;module 'warnings' from 'C:\\Users\\User\\AppData\\Local\\Programs\\Python\\Python313\\Lib\\warnings.py'&gt;
..\..\AppData\Local\Programs\Python\Python313\Lib\site-packages\langchain_core\prompt_values.py:137: in &lt;module&gt;
    class ChatPromptValueConcrete(ChatPromptValue):
        ABC        = &lt;class 'abc.ABC'&gt;
        AnyMessage = typing.Annotated[typing.Union[typing.Annotated[langchain_core.messages.ai.AIMessage, Tag(tag='ai')], typing.Annotated[langchain_core.messages.human.HumanMessage, Tag(tag='human')], typing.Annotated[langchain_core.messages.chat.ChatMessage, Tag(tag='chat')], typing.Annotated[langchain_core.messages.system.SystemMessage, Tag(tag='system')], typing.Annotated[langchain_core.messages.function.FunctionMessage, Tag(tag='function')], typing.Annotated[langchain_core.messages.tool.ToolMessage, Tag(tag='tool')], typing.Annotated[langchain_core.messages.ai.AIMessageChunk, Tag(tag='AIMessageChunk')], typing.Annotated[langchain_core.messages.human.HumanMessageChunk, Tag(tag='HumanMessageChunk')], typing.Annotated[langchain_core.messages.chat.ChatMessageChunk, Tag(tag='ChatMessageChunk')], typing.Annotated[langchain_core.messages.system.SystemMessageChunk, Tag(tag='SystemMessageChunk')], typing.Annotated[langchain_core.messages.function.FunctionMessageChunk, Tag(tag='FunctionMessageChunk')], typing.Annotated[langchain_core.messages.tool.ToolMessageChunk, Tag(tag='ToolMessageChunk')]], FieldInfo(annotation=NoneType, required=True, discriminator=Discriminator(discriminator=&lt;function _get_type at 0x00000173EADB7D80&gt;, custom_error_type=None, custom_error_message=None, custom_error_context=None))]
        BaseMessage = &lt;class 'langchain_core.messages.base.BaseMessage'&gt;
        ChatPromptValue = &lt;class 'langchain_core.prompt_values.ChatPromptValue'&gt;
        HumanMessage = &lt;class 'langchain_core.messages.human.HumanMessage'&gt;
        ImagePromptValue = &lt;class 'langchain_core.prompt_values.ImagePromptValue'&gt;
        ImageURL   = &lt;class 'langchain_core.prompt_values.ImageURL'&gt;
        Literal    = typing.Literal
        PromptValue = &lt;class 'langchain_core.prompt_values.PromptValue'&gt;
        Sequence   = &lt;class 'collections.abc.Sequence'&gt;
        Serializable = &lt;class 'langchain_core.load.serializable.Serializable'&gt;
        StringPromptValue = &lt;class 'langchain_core.prompt_values.StringPromptValue'&gt;
        TypedDict  = typing_extensions.TypedDict
        __builtins__ = &lt;builtins&gt;
        __cached__ = 'C:\\Users\\User\\AppData\\Local\\Programs\\Python\\Python313\\Lib\\site-packages\\langchain_core\\__pycache__\\prompt_values.cpython-313.pyc'
        __doc__    = ('**Prompt values** for language model prompts.\n'
 '\n'
 'Prompt values are used to represent different pieces of prompts.\n'
 'They can be used to represent text, images, or chat message pieces.\n')
        __file__   = 'C:\\Users\\User\\AppData\\Local\\Programs\\Python\\Python313\\Lib\\site-packages\\langchain_core\\prompt_values.py'
        __loader__ = &lt;_frozen_importlib_external.SourceFileLoader object at 0x00000173EA8D7470&gt;
        __name__   = 'langchain_core.prompt_values'
        __package__ = 'langchain_core'
        __spec__   = ModuleSpec(name='langchain_core.prompt_values', loader=&lt;_frozen_importlib_external.SourceFileLoader object at 0x00000173EA8D7470&gt;, origin='C:\\Users\\User\\AppData\\Local\\Programs\\Python\\Python313\\Lib\\site-packages\\langchain_core\\prompt_values.py')
        abstractmethod = &lt;function abstractmethod at 0x00000173C08CB6A0&gt;
        annotations = _Feature((3, 7, 0, 'beta', 1), None, 16777216)
        cast       = &lt;function cast at 0x00000173C0F11DA0&gt;
        get_buffer_string = &lt;function get_buffer_string at 0x00000173EAD90CC0&gt;
..\..\AppData\Local\Programs\Python\Python313\Lib\site-packages\pydantic\_internal\_model_construction.py:255: in __new__
    complete_model_class(
        BaseModel_ = &lt;class 'pydantic.main.BaseModel'&gt;
        __class__  = &lt;class 'pydantic._internal._model_construction.ModelMetaclass'&gt;
        __pydantic_generic_metadata__ = None
        __pydantic_reset_parent_namespace__ = True
        _create_model_module = None
        base_field_names = {'messages'}
        base_private_attributes = {}
        bases      = (&lt;class 'langchain_core.prompt_values.ChatPromptValue'&gt;,)
        class_vars = set()
        cls        = &lt;class 'langchain_core.prompt_values.ChatPromptValueConcrete'&gt;
        cls_name   = 'ChatPromptValueConcrete'
        config_wrapper = ConfigWrapper(extra='ignore')
        kwargs     = {}
        mcs        = &lt;class 'pydantic._internal._model_construction.ModelMetaclass'&gt;
        mro        = (&lt;class 'langchain_core.prompt_values.ChatPromptValueConcrete'&gt;,
 &lt;class 'langchain_core.prompt_values.ChatPromptValue'&gt;,
 &lt;class 'langchain_core.prompt_values.PromptValue'&gt;,
 &lt;class 'langchain_core.load.serializable.Serializable'&gt;,
 &lt;class 'pydantic.main.BaseModel'&gt;,
 &lt;class 'abc.ABC'&gt;,
 &lt;class 'object'&gt;)
        namespace  = {'__annotations__': {'messages': 'Sequence[AnyMessage]',
                     'type': "Literal['ChatPromptValueConcrete']"},
 '__class_vars__': set(),
 '__doc__': 'Chat prompt value which explicitly lists out the message types it '
            'accepts.\n'
            '\n'
            'For use in external schemas.\n',
 '__firstlineno__': 137,
 '__module__': 'langchain_core.prompt_values',
 '__private_attributes__': {},
 '__qualname__': 'ChatPromptValueConcrete',
 '__static_attributes__': (),
 'model_config': {'extra': 'ignore'},
 'type': 'ChatPromptValueConcrete'}
        ns_resolver = &lt;pydantic._internal._namespace_utils.NsResolver object at 0x00000173EACED400&gt;
        parameters = ()
        parent_namespace = None
        parent_parameters = ()
        private_attributes = {}
        raw_annotations = {'messages': 'Sequence[AnyMessage]',
 'type': "Literal['ChatPromptValueConcrete']"}
..\..\AppData\Local\Programs\Python\Python313\Lib\site-packages\pydantic\_internal\_model_construction.py:648: in complete_model_class
    schema = gen_schema.generate_schema(cls)
             ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
        call_on_complete_hook = True
        cls        = &lt;class 'langchain_core.prompt_values.ChatPromptValueConcrete'&gt;
        config_wrapper = ConfigWrapper(extra='ignore')
        create_model_module = None
        gen_schema = &lt;pydantic._internal._generate_schema.GenerateSchema object at 0x00000173EABFEBB0&gt;
        ns_resolver = &lt;pydantic._internal._namespace_utils.NsResolver object at 0x00000173EACED400&gt;
        raise_errors = False
        typevars_map = {}
..\..\AppData\Local\Programs\Python\Python313\Lib\site-packages\pydantic\_internal\_generate_schema.py:729: in generate_schema
    schema = self._generate_schema_inner(obj)
             ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
        obj        = &lt;class 'langchain_core.prompt_values.ChatPromptValueConcrete'&gt;
        schema     = None
        self       = &lt;pydantic._internal._generate_schema.GenerateSchema object at 0x00000173EABFEBB0&gt;
..\..\AppData\Local\Programs\Python\Python313\Lib\site-packages\pydantic\_internal\_generate_schema.py:1023: in _generate_schema_inner
    return self._model_schema(obj)
           ^^^^^^^^^^^^^^^^^^^^^^^
        BaseModel  = &lt;class 'pydantic.main.BaseModel'&gt;
        obj        = &lt;class 'langchain_core.prompt_values.ChatPromptValueConcrete'&gt;
        self       = &lt;pydantic._internal._generate_schema.GenerateSchema object at 0x00000173EABFEBB0&gt;
..\..\AppData\Local\Programs\Python\Python313\Lib\site-packages\pydantic\_internal\_generate_schema.py:856: in _model_schema
    {k: self._generate_md_field_schema(k, v, decorators) for k, v in fields.items()},
        ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
        BaseModel_ = &lt;class 'pydantic.main.BaseModel'&gt;
        cls        = &lt;class 'langchain_core.prompt_values.ChatPromptValueConcrete'&gt;
        computed_fields = {}
        config_wrapper = ConfigWrapper(extra='ignore')
        core_config = {'extra_fields_behavior': 'ignore', 'title': 'ChatPromptValueConcrete'}
        decorators = DecoratorInfos(validators={},
               field_validators={},
               root_validators={},
               field_serializers={},
               model_serializers={},
               model_validators={},
               computed_fields={})
        extras_keys_schema = None
        extras_schema = None
        fields     = {'messages': FieldInfo(annotation=Sequence[Annotated[Union[Annotated[AIMessage, Tag], Annotated[HumanMessage, Tag], Annotated[ChatMessage, Tag], Annotated[SystemMessage, Tag], Annotated[FunctionMessage, Tag], Annotated[ToolMessage, Tag], Annotated[AIMessageChunk, Tag], Annotated[HumanMessageChunk, Tag], Annotated[ChatMessageChunk, Tag], Annotated[SystemMessageChunk, Tag], Annotated[FunctionMessageChunk, Tag], Annotated[ToolMessageChunk, Tag]], FieldInfo(annotation=NoneType, required=True, discriminator=Discriminator(discriminator=&lt;function _get_type at 0x00000173EADB7D80&gt;, custom_error_type=None, custom_error_message=None, custom_error_context=None))]], required=True),
 'type': FieldInfo(annotation=Literal['ChatPromptValueConcrete'], required=False, default='ChatPromptValueConcrete')}
        generic_origin = None
        maybe_schema = None
        model_ref  = 'langchain_core.prompt_values.ChatPromptValueConcrete:1597334034656'
        model_validators = dict_values([])
        schema     = None
        self       = &lt;pydantic._internal._generate_schema.GenerateSchema object at 0x00000173EABFEBB0&gt;
..\..\AppData\Local\Programs\Python\Python313\Lib\site-packages\pydantic\_internal\_generate_schema.py:1228: in _generate_md_field_schema
    schema, metadata = self._common_field_schema(name, field_info, decorators)
                       ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
        decorators = DecoratorInfos(validators={},
               field_validators={},
               root_validators={},
               field_serializers={},
               model_serializers={},
               model_validators={},
               computed_fields={})
        field_info = FieldInfo(annotation=Sequence[Annotated[Union[Annotated[AIMessage, Tag], Annotated[HumanMessage, Tag], Annotated[ChatMessage, Tag], Annotated[SystemMessage, Tag], Annotated[FunctionMessage, Tag], Annotated[ToolMessage, Tag], Annotated[AIMessageChunk, Tag], Annotated[HumanMessageChunk, Tag], Annotated[ChatMessageChunk, Tag], Annotated[SystemMessageChunk, Tag], Annotated[FunctionMessageChunk, Tag], Annotated[ToolMessageChunk, Tag]], FieldInfo(annotation=NoneType, required=True, discriminator=Discriminator(discriminator=&lt;function _get_type at 0x00000173EADB7D80&gt;, custom_error_type=None, custom_error_message=None, custom_error_context=None))]], required=True)
        name       = 'messages'
        self       = &lt;pydantic._internal._generate_schema.GenerateSchema object at 0x00000173EABFEBB0&gt;
..\..\AppData\Local\Programs\Python\Python313\Lib\site-packages\pydantic\_internal\_generate_schema.py:1282: in _common_field_schema
    schema = self._apply_annotations(
        annotations = []
        decorators = DecoratorInfos(validators={},
               field_validators={},
               root_validators={},
               field_serializers={},
               model_serializers={},
               model_validators={},
               computed_fields={})
        field_info = FieldInfo(annotation=Sequence[Annotated[Union[Annotated[AIMessage, Tag], Annotated[HumanMessage, Tag], Annotated[ChatMessage, Tag], Annotated[SystemMessage, Tag], Annotated[FunctionMessage, Tag], Annotated[ToolMessage, Tag], Annotated[AIMessageChunk, Tag], Annotated[HumanMessageChunk, Tag], Annotated[ChatMessageChunk, Tag], Annotated[SystemMessageChunk, Tag], Annotated[FunctionMessageChunk, Tag], Annotated[ToolMessageChunk, Tag]], FieldInfo(annotation=NoneType, required=True, discriminator=Discriminator(discriminator=&lt;function _get_type at 0x00000173EADB7D80&gt;, custom_error_type=None, custom_error_message=None, custom_error_context=None))]], required=True)
        name       = 'messages'
        self       = &lt;pydantic._internal._generate_schema.GenerateSchema object at 0x00000173EABFEBB0&gt;
        set_discriminator = &lt;function GenerateSchema._common_field_schema.&lt;locals&gt;.set_discriminator at 0x00000173EA69BBA0&gt;
        source_type = collections.abc.Sequence[typing.Annotated[typing.Union[typing.Annotated[langchain_core.messages.ai.AIMessage, Tag(tag='ai')], typing.Annotated[langchain_core.messages.human.HumanMessage, Tag(tag='human')], typing.Annotated[langchain_core.messages.chat.ChatMessage, Tag(tag='chat')], typing.Annotated[langchain_core.messages.system.SystemMessage, Tag(tag='system')], typing.Annotated[langchain_core.messages.function.FunctionMessage, Tag(tag='function')], typing.Annotated[langchain_core.messages.tool.ToolMessage, Tag(tag='tool')], typing.Annotated[langchain_core.messages.ai.AIMessageChunk, Tag(tag='AIMessageChunk')], typing.Annotated[langchain_core.messages.human.HumanMessageChunk, Tag(tag='HumanMessageChunk')], typing.Annotated[langchain_core.messages.chat.ChatMessageChunk, Tag(tag='ChatMessageChunk')], typing.Annotated[langchain_core.messages.system.SystemMessageChunk, Tag(tag='SystemMessageChunk')], typing.Annotated[langchain_core.messages.function.FunctionMessageChunk, Tag(tag='FunctionMessageChunk')], typing.Annotated[langchain_core.messages.tool.ToolMessageChunk, Tag(tag='ToolMessageChunk')]], FieldInfo(annotation=NoneType, required=True, discriminator=Discriminator(discriminator=&lt;function _get_type at 0x00000173EADB7D80&gt;, custom_error_type=None, custom_error_message=None, custom_error_context=None))]]
        validators_from_decorators = []
..\..\AppData\Local\Programs\Python\Python313\Lib\site-packages\pydantic\_internal\_generate_schema.py:2227: in _apply_annotations
    schema = get_inner_schema(source_type)
             ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
        annotations = []
        check_unsupported_field_info_attributes = True
        get_inner_schema = &lt;pydantic._internal._schema_generation_shared.CallbackGetCoreSchemaHandler object at 0x00000173EA8D4590&gt;
        inner_handler = &lt;function GenerateSchema._apply_annotations.&lt;locals&gt;.inner_handler at 0x00000173EA69BC40&gt;
        pydantic_js_annotation_functions = []
        self       = &lt;pydantic._internal._generate_schema.GenerateSchema object at 0x00000173EABFEBB0&gt;
        source_type = collections.abc.Sequence[typing.Annotated[typing.Union[typing.Annotated[langchain_core.messages.ai.AIMessage, Tag(tag='ai')], typing.Annotated[langchain_core.messages.human.HumanMessage, Tag(tag='human')], typing.Annotated[langchain_core.messages.chat.ChatMessage, Tag(tag='chat')], typing.Annotated[langchain_core.messages.system.SystemMessage, Tag(tag='system')], typing.Annotated[langchain_core.messages.function.FunctionMessage, Tag(tag='function')], typing.Annotated[langchain_core.messages.tool.ToolMessage, Tag(tag='tool')], typing.Annotated[langchain_core.messages.ai.AIMessageChunk, Tag(tag='AIMessageChunk')], typing.Annotated[langchain_core.messages.human.HumanMessageChunk, Tag(tag='HumanMessageChunk')], typing.Annotated[langchain_core.messages.chat.ChatMessageChunk, Tag(tag='ChatMessageChunk')], typing.Annotated[langchain_core.messages.system.SystemMessageChunk, Tag(tag='SystemMessageChunk')], typing.Annotated[langchain_core.messages.function.FunctionMessageChunk, Tag(tag='FunctionMessageChunk')], typing.Annotated[langchain_core.messages.tool.ToolMessageChunk, Tag(tag='ToolMessageChunk')]], FieldInfo(annotation=NoneType, required=True, discriminator=Discriminator(discriminator=&lt;function _get_type at 0x00000173EADB7D80&gt;, custom_error_type=None, custom_error_message=None, custom_error_context=None))]]
        transform_inner_schema = &lt;function GenerateSchema.&lt;lambda&gt; at 0x00000173C67EF240&gt;
..\..\AppData\Local\Programs\Python\Python313\Lib\site-packages\pydantic\_internal\_schema_generation_shared.py:83: in __call__
    schema = self._handler(source_type)
             ^^^^^^^^^^^^^^^^^^^^^^^^^^
        self       = &lt;pydantic._internal._schema_generation_shared.CallbackGetCoreSchemaHandler object at 0x00000173EA8D4590&gt;
        source_type = collections.abc.Sequence[typing.Annotated[typing.Union[typing.Annotated[langchain_core.messages.ai.AIMessage, Tag(tag='ai')], typing.Annotated[langchain_core.messages.human.HumanMessage, Tag(tag='human')], typing.Annotated[langchain_core.messages.chat.ChatMessage, Tag(tag='chat')], typing.Annotated[langchain_core.messages.system.SystemMessage, Tag(tag='system')], typing.Annotated[langchain_core.messages.function.FunctionMessage, Tag(tag='function')], typing.Annotated[langchain_core.messages.tool.ToolMessage, Tag(tag='tool')], typing.Annotated[langchain_core.messages.ai.AIMessageChunk, Tag(tag='AIMessageChunk')], typing.Annotated[langchain_core.messages.human.HumanMessageChunk, Tag(tag='HumanMessageChunk')], typing.Annotated[langchain_core.messages.chat.ChatMessageChunk, Tag(tag='ChatMessageChunk')], typing.Annotated[langchain_core.messages.system.SystemMessageChunk, Tag(tag='SystemMessageChunk')], typing.Annotated[langchain_core.messages.function.FunctionMessageChunk, Tag(tag='FunctionMessageChunk')], typing.Annotated[langchain_core.messages.tool.ToolMessageChunk, Tag(tag='ToolMessageChunk')]], FieldInfo(annotation=NoneType, required=True, discriminator=Discriminator(discriminator=&lt;function _get_type at 0x00000173EADB7D80&gt;, custom_error_type=None, custom_error_message=None, custom_error_context=None))]]
..\..\AppData\Local\Programs\Python\Python313\Lib\site-packages\pydantic\_internal\_generate_schema.py:2206: in inner_handler
    schema = self._generate_schema_inner(obj)
             ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
        obj        = collections.abc.Sequence[typing.Annotated[typing.Union[typing.Annotated[langchain_core.messages.ai.AIMessage, Tag(tag='ai')], typing.Annotated[langchain_core.messages.human.HumanMessage, Tag(tag='human')], typing.Annotated[langchain_core.messages.chat.ChatMessage, Tag(tag='chat')], typing.Annotated[langchain_core.messages.system.SystemMessage, Tag(tag='system')], typing.Annotated[langchain_core.messages.function.FunctionMessage, Tag(tag='function')], typing.Annotated[langchain_core.messages.tool.ToolMessage, Tag(tag='tool')], typing.Annotated[langchain_core.messages.ai.AIMessageChunk, Tag(tag='AIMessageChunk')], typing.Annotated[langchain_core.messages.human.HumanMessageChunk, Tag(tag='HumanMessageChunk')], typing.Annotated[langchain_core.messages.chat.ChatMessageChunk, Tag(tag='ChatMessageChunk')], typing.Annotated[langchain_core.messages.system.SystemMessageChunk, Tag(tag='SystemMessageChunk')], typing.Annotated[langchain_core.messages.function.FunctionMessageChunk, Tag(tag='FunctionMessageChunk')], typing.Annotated[langchain_core.messages.tool.ToolMessageChunk, Tag(tag='ToolMessageChunk')]], FieldInfo(annotation=NoneType, required=True, discriminator=Discriminator(discriminator=&lt;function _get_type at 0x00000173EADB7D80&gt;, custom_error_type=None, custom_error_message=None, custom_error_context=None))]]
        schema     = None
        self       = &lt;pydantic._internal._generate_schema.GenerateSchema object at 0x00000173EABFEBB0&gt;
        source_type = collections.abc.Sequence[typing.Annotated[typing.Union[typing.Annotated[langchain_core.messages.ai.AIMessage, Tag(tag='ai')], typing.Annotated[langchain_core.messages.human.HumanMessage, Tag(tag='human')], typing.Annotated[langchain_core.messages.chat.ChatMessage, Tag(tag='chat')], typing.Annotated[langchain_core.messages.system.SystemMessage, Tag(tag='system')], typing.Annotated[langchain_core.messages.function.FunctionMessage, Tag(tag='function')], typing.Annotated[langchain_core.messages.tool.ToolMessage, Tag(tag='tool')], typing.Annotated[langchain_core.messages.ai.AIMessageChunk, Tag(tag='AIMessageChunk')], typing.Annotated[langchain_core.messages.human.HumanMessageChunk, Tag(tag='HumanMessageChunk')], typing.Annotated[langchain_core.messages.chat.ChatMessageChunk, Tag(tag='ChatMessageChunk')], typing.Annotated[langchain_core.messages.system.SystemMessageChunk, Tag(tag='SystemMessageChunk')], typing.Annotated[langchain_core.messages.function.FunctionMessageChunk, Tag(tag='FunctionMessageChunk')], typing.Annotated[langchain_core.messages.tool.ToolMessageChunk, Tag(tag='ToolMessageChunk')]], FieldInfo(annotation=NoneType, required=True, discriminator=Discriminator(discriminator=&lt;function _get_type at 0x00000173EADB7D80&gt;, custom_error_type=None, custom_error_message=None, custom_error_context=None))]]
        transform_inner_schema = &lt;function GenerateSchema.&lt;lambda&gt; at 0x00000173C67EF240&gt;
..\..\AppData\Local\Programs\Python\Python313\Lib\site-packages\pydantic\_internal\_generate_schema.py:1028: in _generate_schema_inner
    return self.match_type(obj)
           ^^^^^^^^^^^^^^^^^^^^
        BaseModel  = &lt;class 'pydantic.main.BaseModel'&gt;
        obj        = collections.abc.Sequence[typing.Annotated[typing.Union[typing.Annotated[langchain_core.messages.ai.AIMessage, Tag(tag='ai')], typing.Annotated[langchain_core.messages.human.HumanMessage, Tag(tag='human')], typing.Annotated[langchain_core.messages.chat.ChatMessage, Tag(tag='chat')], typing.Annotated[langchain_core.messages.system.SystemMessage, Tag(tag='system')], typing.Annotated[langchain_core.messages.function.FunctionMessage, Tag(tag='function')], typing.Annotated[langchain_core.messages.tool.ToolMessage, Tag(tag='tool')], typing.Annotated[langchain_core.messages.ai.AIMessageChunk, Tag(tag='AIMessageChunk')], typing.Annotated[langchain_core.messages.human.HumanMessageChunk, Tag(tag='HumanMessageChunk')], typing.Annotated[langchain_core.messages.chat.ChatMessageChunk, Tag(tag='ChatMessageChunk')], typing.Annotated[langchain_core.messages.system.SystemMessageChunk, Tag(tag='SystemMessageChunk')], typing.Annotated[langchain_core.messages.function.FunctionMessageChunk, Tag(tag='FunctionMessageChunk')], typing.Annotated[langchain_core.messages.tool.ToolMessageChunk, Tag(tag='ToolMessageChunk')]], FieldInfo(annotation=NoneType, required=True, discriminator=Discriminator(discriminator=&lt;function _get_type at 0x00000173EADB7D80&gt;, custom_error_type=None, custom_error_message=None, custom_error_context=None))]]
        self       = &lt;pydantic._internal._generate_schema.GenerateSchema object at 0x00000173EABFEBB0&gt;
..\..\AppData\Local\Programs\Python\Python313\Lib\site-packages\pydantic\_internal\_generate_schema.py:1144: in match_type
    return self._match_generic_type(obj, origin)
           ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
        obj        = collections.abc.Sequence[typing.Annotated[typing.Union[typing.Annotated[langchain_core.messages.ai.AIMessage, Tag(tag='ai')], typing.Annotated[langchain_core.messages.human.HumanMessage, Tag(tag='human')], typing.Annotated[langchain_core.messages.chat.ChatMessage, Tag(tag='chat')], typing.Annotated[langchain_core.messages.system.SystemMessage, Tag(tag='system')], typing.Annotated[langchain_core.messages.function.FunctionMessage, Tag(tag='function')], typing.Annotated[langchain_core.messages.tool.ToolMessage, Tag(tag='tool')], typing.Annotated[langchain_core.messages.ai.AIMessageChunk, Tag(tag='AIMessageChunk')], typing.Annotated[langchain_core.messages.human.HumanMessageChunk, Tag(tag='HumanMessageChunk')], typing.Annotated[langchain_core.messages.chat.ChatMessageChunk, Tag(tag='ChatMessageChunk')], typing.Annotated[langchain_core.messages.system.SystemMessageChunk, Tag(tag='SystemMessageChunk')], typing.Annotated[langchain_core.messages.function.FunctionMessageChunk, Tag(tag='FunctionMessageChunk')], typing.Annotated[langchain_core.messages.tool.ToolMessageChunk, Tag(tag='ToolMessageChunk')]], FieldInfo(annotation=NoneType, required=True, discriminator=Discriminator(discriminator=&lt;function _get_type at 0x00000173EADB7D80&gt;, custom_error_type=None, custom_error_message=None, custom_error_context=None))]]
        origin     = &lt;class 'collections.abc.Sequence'&gt;
        self       = &lt;pydantic._internal._generate_schema.GenerateSchema object at 0x00000173EABFEBB0&gt;
..\..\AppData\Local\Programs\Python\Python313\Lib\site-packages\pydantic\_internal\_generate_schema.py:1191: in _match_generic_type
    return self._sequence_schema(self._get_first_arg_or_any(obj))
           ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
        obj        = collections.abc.Sequence[typing.Annotated[typing.Union[typing.Annotated[langchain_core.messages.ai.AIMessage, Tag(tag='ai')], typing.Annotated[langchain_core.messages.human.HumanMessage, Tag(tag='human')], typing.Annotated[langchain_core.messages.chat.ChatMessage, Tag(tag='chat')], typing.Annotated[langchain_core.messages.system.SystemMessage, Tag(tag='system')], typing.Annotated[langchain_core.messages.function.FunctionMessage, Tag(tag='function')], typing.Annotated[langchain_core.messages.tool.ToolMessage, Tag(tag='tool')], typing.Annotated[langchain_core.messages.ai.AIMessageChunk, Tag(tag='AIMessageChunk')], typing.Annotated[langchain_core.messages.human.HumanMessageChunk, Tag(tag='HumanMessageChunk')], typing.Annotated[langchain_core.messages.chat.ChatMessageChunk, Tag(tag='ChatMessageChunk')], typing.Annotated[langchain_core.messages.system.SystemMessageChunk, Tag(tag='SystemMessageChunk')], typing.Annotated[langchain_core.messages.function.FunctionMessageChunk, Tag(tag='FunctionMessageChunk')], typing.Annotated[langchain_core.messages.tool.ToolMessageChunk, Tag(tag='ToolMessageChunk')]], FieldInfo(annotation=NoneType, required=True, discriminator=Discriminator(discriminator=&lt;function _get_type at 0x00000173EADB7D80&gt;, custom_error_type=None, custom_error_message=None, custom_error_context=None))]]
        origin     = &lt;class 'collections.abc.Sequence'&gt;
        schema     = None
        self       = &lt;pydantic._internal._generate_schema.GenerateSchema object at 0x00000173EABFEBB0&gt;
..\..\AppData\Local\Programs\Python\Python313\Lib\site-packages\pydantic\_internal\_generate_schema.py:1751: in _sequence_schema
    item_type_schema = self.generate_schema(items_type)
                       ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
        items_type = typing.Annotated[typing.Union[typing.Annotated[langchain_core.messages.ai.AIMessage, Tag(tag='ai')], typing.Annotated[langchain_core.messages.human.HumanMessage, Tag(tag='human')], typing.Annotated[langchain_core.messages.chat.ChatMessage, Tag(tag='chat')], typing.Annotated[langchain_core.messages.system.SystemMessage, Tag(tag='system')], typing.Annotated[langchain_core.messages.function.FunctionMessage, Tag(tag='function')], typing.Annotated[langchain_core.messages.tool.ToolMessage, Tag(tag='tool')], typing.Annotated[langchain_core.messages.ai.AIMessageChunk, Tag(tag='AIMessageChunk')], typing.Annotated[langchain_core.messages.human.HumanMessageChunk, Tag(tag='HumanMessageChunk')], typing.Annotated[langchain_core.messages.chat.ChatMessageChunk, Tag(tag='ChatMessageChunk')], typing.Annotated[langchain_core.messages.system.SystemMessageChunk, Tag(tag='SystemMessageChunk')], typing.Annotated[langchain_core.messages.function.FunctionMessageChunk, Tag(tag='FunctionMessageChunk')], typing.Annotated[langchain_core.messages.tool.ToolMessageChunk, Tag(tag='ToolMessageChunk')]], FieldInfo(annotation=NoneType, required=True, discriminator=Discriminator(discriminator=&lt;function _get_type at 0x00000173EADB7D80&gt;, custom_error_type=None, custom_error_message=None, custom_error_context=None))]
        self       = &lt;pydantic._internal._generate_schema.GenerateSchema object at 0x00000173EABFEBB0&gt;
        serialize_sequence_via_list = &lt;function serialize_sequence_via_list at 0x00000173EC58F880&gt;
..\..\AppData\Local\Programs\Python\Python313\Lib\site-packages\pydantic\_internal\_generate_schema.py:729: in generate_schema
    schema = self._generate_schema_inner(obj)
             ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
        obj        = typing.Annotated[typing.Union[typing.Annotated[langchain_core.messages.ai.AIMessage, Tag(tag='ai')], typing.Annotated[langchain_core.messages.human.HumanMessage, Tag(tag='human')], typing.Annotated[langchain_core.messages.chat.ChatMessage, Tag(tag='chat')], typing.Annotated[langchain_core.messages.system.SystemMessage, Tag(tag='system')], typing.Annotated[langchain_core.messages.function.FunctionMessage, Tag(tag='function')], typing.Annotated[langchain_core.messages.tool.ToolMessage, Tag(tag='tool')], typing.Annotated[langchain_core.messages.ai.AIMessageChunk, Tag(tag='AIMessageChunk')], typing.Annotated[langchain_core.messages.human.HumanMessageChunk, Tag(tag='HumanMessageChunk')], typing.Annotated[langchain_core.messages.chat.ChatMessageChunk, Tag(tag='ChatMessageChunk')], typing.Annotated[langchain_core.messages.system.SystemMessageChunk, Tag(tag='SystemMessageChunk')], typing.Annotated[langchain_core.messages.function.FunctionMessageChunk, Tag(tag='FunctionMessageChunk')], typing.Annotated[langchain_core.messages.tool.ToolMessageChunk, Tag(tag='ToolMessageChunk')]], FieldInfo(annotation=NoneType, required=True, discriminator=Discriminator(discriminator=&lt;function _get_type at 0x00000173EADB7D80&gt;, custom_error_type=None, custom_error_message=None, custom_error_context=None))]
        schema     = None
        self       = &lt;pydantic._internal._generate_schema.GenerateSchema object at 0x00000173EABFEBB0&gt;
..\..\AppData\Local\Programs\Python\Python313\Lib\site-packages\pydantic\_internal\_generate_schema.py:1007: in _generate_schema_inner
    return self._annotated_schema(obj)
           ^^^^^^^^^^^^^^^^^^^^^^^^^^^
        obj        = typing.Annotated[typing.Union[typing.Annotated[langchain_core.messages.ai.AIMessage, Tag(tag='ai')], typing.Annotated[langchain_core.messages.human.HumanMessage, Tag(tag='human')], typing.Annotated[langchain_core.messages.chat.ChatMessage, Tag(tag='chat')], typing.Annotated[langchain_core.messages.system.SystemMessage, Tag(tag='system')], typing.Annotated[langchain_core.messages.function.FunctionMessage, Tag(tag='function')], typing.Annotated[langchain_core.messages.tool.ToolMessage, Tag(tag='tool')], typing.Annotated[langchain_core.messages.ai.AIMessageChunk, Tag(tag='AIMessageChunk')], typing.Annotated[langchain_core.messages.human.HumanMessageChunk, Tag(tag='HumanMessageChunk')], typing.Annotated[langchain_core.messages.chat.ChatMessageChunk, Tag(tag='ChatMessageChunk')], typing.Annotated[langchain_core.messages.system.SystemMessageChunk, Tag(tag='SystemMessageChunk')], typing.Annotated[langchain_core.messages.function.FunctionMessageChunk, Tag(tag='FunctionMessageChunk')], typing.Annotated[langchain_core.messages.tool.ToolMessageChunk, Tag(tag='ToolMessageChunk')]], FieldInfo(annotation=NoneType, required=True, discriminator=Discriminator(discriminator=&lt;function _get_type at 0x00000173EADB7D80&gt;, custom_error_type=None, custom_error_message=None, custom_error_context=None))]
        self       = &lt;pydantic._internal._generate_schema.GenerateSchema object at 0x00000173EABFEBB0&gt;
..\..\AppData\Local\Programs\Python\Python313\Lib\site-packages\pydantic\_internal\_generate_schema.py:2177: in _annotated_schema
    schema = self._apply_annotations(source_type, annotations)
             ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
        FieldInfo  = &lt;class 'pydantic.fields.FieldInfo'&gt;
        annotated_type = typing.Annotated[typing.Union[typing.Annotated[langchain_core.messages.ai.AIMessage, Tag(tag='ai')], typing.Annotated[langchain_core.messages.human.HumanMessage, Tag(tag='human')], typing.Annotated[langchain_core.messages.chat.ChatMessage, Tag(tag='chat')], typing.Annotated[langchain_core.messages.system.SystemMessage, Tag(tag='system')], typing.Annotated[langchain_core.messages.function.FunctionMessage, Tag(tag='function')], typing.Annotated[langchain_core.messages.tool.ToolMessage, Tag(tag='tool')], typing.Annotated[langchain_core.messages.ai.AIMessageChunk, Tag(tag='AIMessageChunk')], typing.Annotated[langchain_core.messages.human.HumanMessageChunk, Tag(tag='HumanMessageChunk')], typing.Annotated[langchain_core.messages.chat.ChatMessageChunk, Tag(tag='ChatMessageChunk')], typing.Annotated[langchain_core.messages.system.SystemMessageChunk, Tag(tag='SystemMessageChunk')], typing.Annotated[langchain_core.messages.function.FunctionMessageChunk, Tag(tag='FunctionMessageChunk')], typing.Annotated[langchain_core.messages.tool.ToolMessageChunk, Tag(tag='ToolMessageChunk')]], FieldInfo(annotation=NoneType, required=True, discriminator=Discriminator(discriminator=&lt;function _get_type at 0x00000173EADB7D80&gt;, custom_error_type=None, custom_error_message=None, custom_error_context=None))]
        annotations = [FieldInfo(annotation=NoneType, required=True, discriminator=Discriminator(discriminator=&lt;function _get_type at 0x00000173EADB7D80&gt;, custom_error_type=None, custom_error_message=None, custom_error_context=None))]
        self       = &lt;pydantic._internal._generate_schema.GenerateSchema object at 0x00000173EABFEBB0&gt;
        source_type = typing.Union[typing.Annotated[langchain_core.messages.ai.AIMessage, Tag(tag='ai')], typing.Annotated[langchain_core.messages.human.HumanMessage, Tag(tag='human')], typing.Annotated[langchain_core.messages.chat.ChatMessage, Tag(tag='chat')], typing.Annotated[langchain_core.messages.system.SystemMessage, Tag(tag='system')], typing.Annotated[langchain_core.messages.function.FunctionMessage, Tag(tag='function')], typing.Annotated[langchain_core.messages.tool.ToolMessage, Tag(tag='tool')], typing.Annotated[langchain_core.messages.ai.AIMessageChunk, Tag(tag='AIMessageChunk')], typing.Annotated[langchain_core.messages.human.HumanMessageChunk, Tag(tag='HumanMessageChunk')], typing.Annotated[langchain_core.messages.chat.ChatMessageChunk, Tag(tag='ChatMessageChunk')], typing.Annotated[langchain_core.messages.system.SystemMessageChunk, Tag(tag='SystemMessageChunk')], typing.Annotated[langchain_core.messages.function.FunctionMessageChunk, Tag(tag='FunctionMessageChunk')], typing.Annotated[langchain_core.messages.tool.ToolMessageChunk, Tag(tag='ToolMessageChunk')]]
..\..\AppData\Local\Programs\Python\Python313\Lib\site-packages\pydantic\_internal\_generate_schema.py:2227: in _apply_annotations
    schema = get_inner_schema(source_type)
             ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
        annotation = FieldInfo(annotation=NoneType, required=True, discriminator=Discriminator(discriminator=&lt;function _get_type at 0x00000173EADB7D80&gt;, custom_error_type=None, custom_error_message=None, custom_error_context=None))
        annotations = [FieldInfo(annotation=NoneType, required=True, discriminator=Discriminator(discriminator=&lt;function _get_type at 0x00000173EADB7D80&gt;, custom_error_type=None, custom_error_message=None, custom_error_context=None))]
        check_unsupported_field_info_attributes = True
        get_inner_schema = &lt;pydantic._internal._schema_generation_shared.CallbackGetCoreSchemaHandler object at 0x00000173EA8D5190&gt;
        inner_handler = &lt;function GenerateSchema._apply_annotations.&lt;locals&gt;.inner_handler at 0x00000173EA69B920&gt;
        pydantic_js_annotation_functions = []
        self       = &lt;pydantic._internal._generate_schema.GenerateSchema object at 0x00000173EABFEBB0&gt;
        source_type = typing.Union[typing.Annotated[langchain_core.messages.ai.AIMessage, Tag(tag='ai')], typing.Annotated[langchain_core.messages.human.HumanMessage, Tag(tag='human')], typing.Annotated[langchain_core.messages.chat.ChatMessage, Tag(tag='chat')], typing.Annotated[langchain_core.messages.system.SystemMessage, Tag(tag='system')], typing.Annotated[langchain_core.messages.function.FunctionMessage, Tag(tag='function')], typing.Annotated[langchain_core.messages.tool.ToolMessage, Tag(tag='tool')], typing.Annotated[langchain_core.messages.ai.AIMessageChunk, Tag(tag='AIMessageChunk')], typing.Annotated[langchain_core.messages.human.HumanMessageChunk, Tag(tag='HumanMessageChunk')], typing.Annotated[langchain_core.messages.chat.ChatMessageChunk, Tag(tag='ChatMessageChunk')], typing.Annotated[langchain_core.messages.system.SystemMessageChunk, Tag(tag='SystemMessageChunk')], typing.Annotated[langchain_core.messages.function.FunctionMessageChunk, Tag(tag='FunctionMessageChunk')], typing.Annotated[langchain_core.messages.tool.ToolMessageChunk, Tag(tag='ToolMessageChunk')]]
        transform_inner_schema = &lt;function GenerateSchema.&lt;lambda&gt; at 0x00000173C67EF240&gt;
..\..\AppData\Local\Programs\Python\Python313\Lib\site-packages\pydantic\_internal\_schema_generation_shared.py:83: in __call__
    schema = self._handler(source_type)
             ^^^^^^^^^^^^^^^^^^^^^^^^^^
        self       = &lt;pydantic._internal._schema_generation_shared.CallbackGetCoreSchemaHandler object at 0x00000173EA8D5190&gt;
        source_type = typing.Union[typing.Annotated[langchain_core.messages.ai.AIMessage, Tag(tag='ai')], typing.Annotated[langchain_core.messages.human.HumanMessage, Tag(tag='human')], typing.Annotated[langchain_core.messages.chat.ChatMessage, Tag(tag='chat')], typing.Annotated[langchain_core.messages.system.SystemMessage, Tag(tag='system')], typing.Annotated[langchain_core.messages.function.FunctionMessage, Tag(tag='function')], typing.Annotated[langchain_core.messages.tool.ToolMessage, Tag(tag='tool')], typing.Annotated[langchain_core.messages.ai.AIMessageChunk, Tag(tag='AIMessageChunk')], typing.Annotated[langchain_core.messages.human.HumanMessageChunk, Tag(tag='HumanMessageChunk')], typing.Annotated[langchain_core.messages.chat.ChatMessageChunk, Tag(tag='ChatMessageChunk')], typing.Annotated[langchain_core.messages.system.SystemMessageChunk, Tag(tag='SystemMessageChunk')], typing.Annotated[langchain_core.messages.function.FunctionMessageChunk, Tag(tag='FunctionMessageChunk')], typing.Annotated[langchain_core.messages.tool.ToolMessageChunk, Tag(tag='ToolMessageChunk')]]
..\..\AppData\Local\Programs\Python\Python313\Lib\site-packages\pydantic\_internal\_generate_schema.py:2359: in new_handler
    schema = self._apply_single_annotation(
        annotation = FieldInfo(annotation=NoneType, required=True, discriminator=Discriminator(discriminator=&lt;function _get_type at 0x00000173EADB7D80&gt;, custom_error_type=None, custom_error_message=None, custom_error_context=None))
        annotation_get_schema = None
        check_unsupported_field_info_attributes = True
        get_inner_schema = &lt;pydantic._internal._schema_generation_shared.CallbackGetCoreSchemaHandler object at 0x00000173EA8D4B30&gt;
        pydantic_js_annotation_functions = []
        schema     = {'choices': [({'metadata': {'pydantic_internal_union_tag_key': 'ai'},
               'schema_ref': 'langchain_core.messages.ai.AIMessage:1597346559312',
               'type': 'definition-ref'},
              'ai'),
             ({'metadata': {'pydantic_internal_union_tag_key': 'human'},
               'schema_ref': 'langchain_core.messages.human.HumanMessage:1597346558320',
               'type': 'definition-ref'},
              'human'),
             ({'metadata': {'pydantic_internal_union_tag_key': 'chat'},
               'schema_ref': 'langchain_core.messages.chat.ChatMessage:1597346573200',
               'type': 'definition-ref'},
              'chat'),
             ({'metadata': {'pydantic_internal_union_tag_key': 'system'},
               'schema_ref': 'langchain_core.messages.system.SystemMessage:1597346577168',
               'type': 'definition-ref'},
              'system'),
             ({'metadata': {'pydantic_internal_union_tag_key': 'function'},
               'schema_ref': 'langchain_core.messages.function.FunctionMessage:1597346554352',
               'type': 'definition-ref'},
              'function'),
             ({'metadata': {'pydantic_internal_union_tag_key': 'tool'},
               'schema_ref': 'langchain_core.messages.tool.ToolMessage:1597346539472',
               'type': 'definition-ref'},
              'tool'),
             ({'metadata': {'pydantic_internal_union_tag_key': 'AIMessageChunk'},
               'schema_ref': 'langchain_core.messages.ai.AIMessageChunk:1597346566256',
               'type': 'definition-ref'},
              'AIMessageChunk'),
             ({'metadata': {'pydantic_internal_union_tag_key': 'HumanMessageChunk'},
               'schema_ref': 'langchain_core.messages.human.HumanMessageChunk:1597346553360',
               'type': 'definition-ref'},
              'HumanMessageChunk'),
             ({'metadata': {'pydantic_internal_union_tag_key': 'ChatMessageChunk'},
               'schema_ref': 'langchain_core.messages.chat.ChatMessageChunk:1597346576176',
               'type': 'definition-ref'},
              'ChatMessageChunk'),
             ({'metadata': {'pydantic_internal_union_tag_key': 'SystemMessageChunk'},
               'schema_ref': 'langchain_core.messages.system.SystemMessageChunk:1597346584112',
               'type': 'definition-ref'},
              'SystemMessageChunk'),
             ({'metadata': {'pydantic_internal_union_tag_key': 'FunctionMessageChunk'},
               'schema_ref': 'langchain_core.messages.function.FunctionMessageChunk:1597346564272',
               'type': 'definition-ref'},
              'FunctionMessageChunk'),
             ({'metadata': {'pydantic_internal_union_tag_key': 'ToolMessageChunk'},
               'schema_ref': 'langchain_core.messages.tool.ToolMessageChunk:1597346545424',
               'type': 'definition-ref'},
              'ToolMessageChunk')],
 'type': 'union'}
        self       = &lt;pydantic._internal._generate_schema.GenerateSchema object at 0x00000173EABFEBB0&gt;
        source     = typing.Union[typing.Annotated[langchain_core.messages.ai.AIMessage, Tag(tag='ai')], typing.Annotated[langchain_core.messages.human.HumanMessage, Tag(tag='human')], typing.Annotated[langchain_core.messages.chat.ChatMessage, Tag(tag='chat')], typing.Annotated[langchain_core.messages.system.SystemMessage, Tag(tag='system')], typing.Annotated[langchain_core.messages.function.FunctionMessage, Tag(tag='function')], typing.Annotated[langchain_core.messages.tool.ToolMessage, Tag(tag='tool')], typing.Annotated[langchain_core.messages.ai.AIMessageChunk, Tag(tag='AIMessageChunk')], typing.Annotated[langchain_core.messages.human.HumanMessageChunk, Tag(tag='HumanMessageChunk')], typing.Annotated[langchain_core.messages.chat.ChatMessageChunk, Tag(tag='ChatMessageChunk')], typing.Annotated[langchain_core.messages.system.SystemMessageChunk, Tag(tag='SystemMessageChunk')], typing.Annotated[langchain_core.messages.function.FunctionMessageChunk, Tag(tag='FunctionMessageChunk')], typing.Annotated[langchain_core.messages.tool.ToolMessageChunk, Tag(tag='ToolMessageChunk')]]
..\..\AppData\Local\Programs\Python\Python313\Lib\site-packages\pydantic\_internal\_generate_schema.py:2273: in _apply_single_annotation
    schema = self._apply_discriminator_to_union(schema, metadata.discriminator)
             ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
        FieldInfo  = &lt;class 'pydantic.fields.FieldInfo'&gt;
        check_unsupported_field_info_attributes = True
        metadata   = FieldInfo(annotation=NoneType, required=True, discriminator=Discriminator(discriminator=&lt;function _get_type at 0x00000173EADB7D80&gt;, custom_error_type=None, custom_error_message=None, custom_error_context=None))
        schema     = {'choices': [({'metadata': {'pydantic_internal_union_tag_key': 'ai'},
               'schema_ref': 'langchain_core.messages.ai.AIMessage:1597346559312',
               'type': 'definition-ref'},
              'ai'),
             ({'metadata': {'pydantic_internal_union_tag_key': 'human'},
               'schema_ref': 'langchain_core.messages.human.HumanMessage:1597346558320',
               'type': 'definition-ref'},
              'human'),
             ({'metadata': {'pydantic_internal_union_tag_key': 'chat'},
               'schema_ref': 'langchain_core.messages.chat.ChatMessage:1597346573200',
               'type': 'definition-ref'},
              'chat'),
             ({'metadata': {'pydantic_internal_union_tag_key': 'system'},
               'schema_ref': 'langchain_core.messages.system.SystemMessage:1597346577168',
               'type': 'definition-ref'},
              'system'),
             ({'metadata': {'pydantic_internal_union_tag_key': 'function'},
               'schema_ref': 'langchain_core.messages.function.FunctionMessage:1597346554352',
               'type': 'definition-ref'},
              'function'),
             ({'metadata': {'pydantic_internal_union_tag_key': 'tool'},
               'schema_ref': 'langchain_core.messages.tool.ToolMessage:1597346539472',
               'type': 'definition-ref'},
              'tool'),
             ({'metadata': {'pydantic_internal_union_tag_key': 'AIMessageChunk'},
               'schema_ref': 'langchain_core.messages.ai.AIMessageChunk:1597346566256',
               'type': 'definition-ref'},
              'AIMessageChunk'),
             ({'metadata': {'pydantic_internal_union_tag_key': 'HumanMessageChunk'},
               'schema_ref': 'langchain_core.messages.human.HumanMessageChunk:1597346553360',
               'type': 'definition-ref'},
              'HumanMessageChunk'),
             ({'metadata': {'pydantic_internal_union_tag_key': 'ChatMessageChunk'},
               'schema_ref': 'langchain_core.messages.chat.ChatMessageChunk:1597346576176',
               'type': 'definition-ref'},
              'ChatMessageChunk'),
             ({'metadata': {'pydantic_internal_union_tag_key': 'SystemMessageChunk'},
               'schema_ref': 'langchain_core.messages.system.SystemMessageChunk:1597346584112',
               'type': 'definition-ref'},
              'SystemMessageChunk'),
             ({'metadata': {'pydantic_internal_union_tag_key': 'FunctionMessageChunk'},
               'schema_ref': 'langchain_core.messages.function.FunctionMessageChunk:1597346564272',
               'type': 'definition-ref'},
              'FunctionMessageChunk'),
             ({'metadata': {'pydantic_internal_union_tag_key': 'ToolMessageChunk'},
               'schema_ref': 'langchain_core.messages.tool.ToolMessageChunk:1597346545424',
               'type': 'definition-ref'},
              'ToolMessageChunk')],
 'type': 'union'}
        self       = &lt;pydantic._internal._generate_schema.GenerateSchema object at 0x00000173EABFEBB0&gt;
        unsupported_attributes = []
..\..\AppData\Local\Programs\Python\Python313\Lib\site-packages\pydantic\_internal\_generate_schema.py:675: in _apply_discriminator_to_union
    return _discriminated_union.apply_discriminator(
        discriminator = Discriminator(discriminator=&lt;function _get_type at 0x00000173EADB7D80&gt;,
              custom_error_type=None,
              custom_error_message=None,
              custom_error_context=None)
        schema     = {'choices': [({'metadata': {'pydantic_internal_union_tag_key': 'ai'},
               'schema_ref': 'langchain_core.messages.ai.AIMessage:1597346559312',
               'type': 'definition-ref'},
              'ai'),
             ({'metadata': {'pydantic_internal_union_tag_key': 'human'},
               'schema_ref': 'langchain_core.messages.human.HumanMessage:1597346558320',
               'type': 'definition-ref'},
              'human'),
             ({'metadata': {'pydantic_internal_union_tag_key': 'chat'},
               'schema_ref': 'langchain_core.messages.chat.ChatMessage:1597346573200',
               'type': 'definition-ref'},
              'chat'),
             ({'metadata': {'pydantic_internal_union_tag_key': 'system'},
               'schema_ref': 'langchain_core.messages.system.SystemMessage:1597346577168',
               'type': 'definition-ref'},
              'system'),
             ({'metadata': {'pydantic_internal_union_tag_key': 'function'},
               'schema_ref': 'langchain_core.messages.function.FunctionMessage:1597346554352',
               'type': 'definition-ref'},
              'function'),
             ({'metadata': {'pydantic_internal_union_tag_key': 'tool'},
               'schema_ref': 'langchain_core.messages.tool.ToolMessage:1597346539472',
               'type': 'definition-ref'},
              'tool'),
             ({'metadata': {'pydantic_internal_union_tag_key': 'AIMessageChunk'},
               'schema_ref': 'langchain_core.messages.ai.AIMessageChunk:1597346566256',
               'type': 'definition-ref'},
              'AIMessageChunk'),
             ({'metadata': {'pydantic_internal_union_tag_key': 'HumanMessageChunk'},
               'schema_ref': 'langchain_core.messages.human.HumanMessageChunk:1597346553360',
               'type': 'definition-ref'},
              'HumanMessageChunk'),
             ({'metadata': {'pydantic_internal_union_tag_key': 'ChatMessageChunk'},
               'schema_ref': 'langchain_core.messages.chat.ChatMessageChunk:1597346576176',
               'type': 'definition-ref'},
              'ChatMessageChunk'),
             ({'metadata': {'pydantic_internal_union_tag_key': 'SystemMessageChunk'},
               'schema_ref': 'langchain_core.messages.system.SystemMessageChunk:1597346584112',
               'type': 'definition-ref'},
              'SystemMessageChunk'),
             ({'metadata': {'pydantic_internal_union_tag_key': 'FunctionMessageChunk'},
               'schema_ref': 'langchain_core.messages.function.FunctionMessageChunk:1597346564272',
               'type': 'definition-ref'},
              'FunctionMessageChunk'),
             ({'metadata': {'pydantic_internal_union_tag_key': 'ToolMessageChunk'},
               'schema_ref': 'langchain_core.messages.tool.ToolMessageChunk:1597346545424',
               'type': 'definition-ref'},
              'ToolMessageChunk')],
 'type': 'union'}
        self       = &lt;pydantic._internal._generate_schema.GenerateSchema object at 0x00000173EABFEBB0&gt;
..\..\AppData\Local\Programs\Python\Python313\Lib\site-packages\pydantic\_internal\_discriminated_union.py:70: in apply_discriminator
    return _ApplyInferredDiscriminator(discriminator, definitions or {}).apply(schema)
           ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
        Discriminator = &lt;class 'pydantic.types.Discriminator'&gt;
        definitions = {'langchain_core.messages.ai.AIMessage:1597346559312': {'cls': &lt;class 'langchain_core.messages.ai.AIMessage'&gt;,
                                                        'config': {'extra_fields_behavior': 'allow',
                                                                   'title': 'AIMessage'},
                                                        'custom_init': True,
                                                        'metadata': {'pydantic_js_functions': [&lt;bound method BaseModel.__get_pydantic_json_schema__ of &lt;class 'langchain_core.messages.ai.AIMessage'&gt;&gt;]},
                                                        'ref': 'langchain_core.messages.ai.AIMessage:1597346559312',
                                                        'root_model': False,
                                                        'schema': {'function': {'function': &lt;bound method AIMessage._backwards_compat_tool_calls of &lt;class 'langchain_core.messages.ai.AIMessage'&gt;&gt;,
                                                                                'type': 'no-info'},
                                                                   'schema': {'computed_fields': [],
                                                                              'fields': {'additional_kwargs': {'metadata': {},
                                                                                                               'schema': {'default_factory': &lt;class 'dict'&gt;,
                                                                                                                          'default_factory_takes_data': False,
                                                                                                                          'schema': {'keys_schema': {'type': 'any'},
                                                                                                                                     'type': 'dict',
                                                                                                                                     'values_schema': {'type': 'any'}},
                                                                                                                          'type': 'default'},
                                                                                                               'type': 'model-field'},
                                                                                         'content': {'metadata': {},
                                                                                                     'schema': {'choices': [{'type': 'str'},
                                                                                                                            {'items_schema': {'choices': [{'type': 'str'},
                                                                                                                                                          {'keys_schema': {'type': 'any'},
                                                                                                                                                           'type': 'dict',
                                                                                                                                                           'values_schema': {'type': 'any'}}],
                                                                                                                                              'type': 'union'},
                                                                                                                             'type': 'list'}],
                                                                                                                'type': 'union'},
                                                                                                     'type': 'model-field'},
                                                                                         'id': {'metadata': {},
                                                                                                'schema': {'default': None,
                                                                                                           'schema': {'schema': {'coerce_numbers_to_str': True,
                                                                                                                                 'type': 'str'},
                                                                                                                      'type': 'nullable'},
                                                                                                           'type': 'default'},
                                                                                                'type': 'model-field'},
                                                                                         'invalid_tool_calls': {'metadata': {},
                                                                                                                'schema': {'default': [],
                                                                                                                           'schema': {'items_schema': {'cls': &lt;class 'langchain_core.messages.content.InvalidToolCall'&gt;,
                                                                                                                                                       'computed_fields': [],
                                                                                                                                                       'config': {'extra_fields_behavior': 'allow',
                                                                                                                                                                  'title': 'InvalidToolCall'},
                                                                                                                                                       'extra_behavior': 'allow',
                                                                                                                                                       'fields': {'args': {'metadata': {},
                                                                                                                                                                           'required': True,
                                                                                                                                                                           'schema': {'schema': {'type': 'str'},
                                                                                                                                                                                      'type': 'nullable'},
                                                                                                                                                                           'type': 'typed-dict-field'},
                                                                                                                                                                  'error': {'metadata': {},
                                                                                                                                                                            'required': True,
                                                                                                                                                                            'schema': {'schema': {'type': 'str'},
                                                                                                                                                                                       'type': 'nullable'},
                                                                                                                                                                            'type': 'typed-dict-field'},
                                                                                                                                                                  'extras': {'metadata': {},
                                                                                                                                                                             'required': False,
                                                                                                                                                                             'schema': {'keys_schema': {'type': 'str'},
                                                                                                                                                                                        'type': 'dict',
                                                                                                                                                                                        'values_schema': {'type': 'any'}},
                                                                                                                                                                             'type': 'typed-dict-field'},
                                                                                                                                                                  'id': {'metadata': {},
                                                                                                                                                                         'required': True,
                                                                                                                                                                         'schema': {'schema': {'type': 'str'},
                                                                                                                                                                                    'type': 'nullable'},
                                                                                                                                                                         'type': 'typed-dict-field'},
                                                                                                                                                                  'index': {'metadata': {},
                                                                                                                                                                            'required': False,
                                                                                                                                                                            'schema': {'choices': [{'type': 'int'},
                                                                                                                                                                                                   {'type': 'str'}],
                                                                                                                                                                                       'type': 'union'},
                                                                                                                                                                            'type': 'typed-dict-field'},
                                                                                                                                                                  'name': {'metadata': {},
                                                                                                                                                                           'required': True,
                                                                                                                                                                           'schema': {'schema': {'type': 'str'},
                                                                                                                                                                                      'type': 'nullable'},
                                                                                                                                                                           'type': 'typed-dict-field'},
                                                                                                                                                                  'type': {'metadata': {},
                                                                                                                                                                           'required': True,
                                                                                                                                                                           'schema': {'expected': ['invalid_tool_call'],
                                                                                                                                                                                      'type': 'literal'},
                                                                                                                                                                           'type': 'typed-dict-field'}},
                                                                                                                                                       'ref': 'langchain_core.messages.content.InvalidToolCall:1597346642640',
                                                                                                                                                       'type': 'typed-dict'},
                                                                                                                                      'type': 'list'},
                                                                                                                           'type': 'default'},
                                                                                                                'type': 'model-field'},
                                                                                         'name': {'metadata': {},
                                                                                                  'schema': {'default': None,
                                                                                                             'schema': {'schema': {'type': 'str'},
                                                                                                                        'type': 'nullable'},
                                                                                                             'type': 'default'},
                                                                                                  'type': 'model-field'},
                                                                                         'response_metadata': {'metadata': {},
                                                                                                               'schema': {'default_factory': &lt;class 'dict'&gt;,
                                                                                                                          'default_factory_takes_data': False,
                                                                                                                          'schema': {'keys_schema': {'type': 'any'},
                                                                                                                                     'type': 'dict',
                                                                                                                                     'values_schema': {'type': 'any'}},
                                                                                                                          'type': 'default'},
                                                                                                               'type': 'model-field'},
                                                                                         'tool_calls': {'metadata': {},
                                                                                                        'schema': {'default': [],
                                                                                                                   'schema': {'items_schema': {'cls': &lt;class 'langchain_core.messages.tool.ToolCall'&gt;,
                                                                                                                                               'computed_fields': [],
                                                                                                                                               'config': {'extra_fields_behavior': 'allow',
                                                                                                                                                          'title': 'ToolCall'},
                                                                                                                                               'extra_behavior': 'allow',
                                                                                                                                               'fields': {'args': {'metadata': {},
                                                                                                                                                                   'required': True,
                                                                                                                                                                   'schema': {'keys_schema': {'type': 'str'},
                                                                                                                                                                              'type': 'dict',
                                                                                                                                                                              'values_schema': {'type': 'any'}},
                                                                                                                                                                   'type': 'typed-dict-field'},
                                                                                                                                                          'id': {'metadata': {},
                                                                                                                                                                 'required': True,
                                                                                                                                                                 'schema': {'schema': {'type': 'str'},
                                                                                                                                                                            'type': 'nullable'},
                                                                                                                                                                 'type': 'typed-dict-field'},
                                                                                                                                                          'name': {'metadata': {},
                                                                                                                                                                   'required': True,
                                                                                                                                                                   'schema': {'type': 'str'},
                                                                                                                                                                   'type': 'typed-dict-field'},
                                                                                                                                                          'type': {'metadata': {},
                                                                                                                                                                   'required': False,
                                                                                                                                                                   'schema': {'expected': ['tool_call'],
                                                                                                                                                                              'type': 'literal'},
                                                                                                                                                                   'type': 'typed-dict-field'}},
                                                                                                                                               'ref': 'langchain_core.messages.tool.ToolCall:1597346538480',
                                                                                                                                               'type': 'typed-dict'},
                                                                                                                              'type': 'list'},
                                                                                                                   'type': 'default'},
                                                                                                        'type': 'model-field'},
                                                                                         'type': {'metadata': {},
                                                                                                  'schema': {'default': 'ai',
                                                                                                             'schema': {'expected': ['ai'],
                                                                                                                        'type': 'literal'},
                                                                                                             'type': 'default'},
                                                                                                  'type': 'model-field'},
                                                                                         'usage_metadata': {'metadata': {},
                                                                                                            'schema': {'default': None,
                                                                                                                       'schema': {'schema': {'cls': &lt;class 'langchain_core.messages.ai.UsageMetadata'&gt;,
                                                                                                                                             'computed_fields': [],
                                                                                                                                             'config': {'extra_fields_behavior': 'allow',
                                                                                                                                                        'title': 'UsageMetadata'},
                                                                                                                                             'extra_behavior': 'allow',
                                                                                                                                             'fields': {'input_token_details': {'metadata': {},
                                                                                                                                                                                'required': False,
                                                                                                                                                                                'schema': {'cls': &lt;class 'langchain_core.messages.ai.InputTokenDetails'&gt;,
                                                                                                                                                                                           'computed_fields': [],
                                                                                                                                                                                           'config': {'extra_fields_behavior': 'allow',
                                                                                                                                                                                                      'title': 'InputTokenDetails'},
                                                                                                                                                                                           'extra_behavior': 'allow',
                                                                                                                                                                                           'fields': {'audio': {'metadata': {},
                                                                                                                                                                                                                'required': False,
                                                                                                                                                                                                                'schema': {'type': 'int'},
                                                                                                                                                                                                                'type': 'typed-dict-field'},
                                                                                                                                                                                                      'cache_creation': {'metadata': {},
                                                                                                                                                                                                                         'required': False,
                                                                                                                                                                                                                         'schema': {'type': 'int'},
                                                                                                                                                                                                                         'type': 'typed-dict-field'},
                                                                                                                                                                                                      'cache_read': {'metadata': {},
                                                                                                                                                                                                                     'required': False,
                                                                                                                                                                                                                     'schema': {'type': 'int'},
                                                                                                                                                                                                                     'type': 'typed-dict-field'}},
                                                                                                                                                                                           'ref': 'langchain_core.messages.ai.InputTokenDetails:1597346536496',
                                                                                                                                                                                           'type': 'typed-dict'},
                                                                                                                                                                                'type': 'typed-dict-field'},
                                                                                                                                                        'input_tokens': {'metadata': {},
                                                                                                                                                                         'required': True,
                                                                                                                                                                         'schema': {'type': 'int'},
                                                                                                                                                                         'type': 'typed-dict-field'},
                                                                                                                                                        'output_token_details': {'metadata': {},
                                                                                                                                                                                 'required': False,
                                                                                                                                                                                 'schema': {'cls': &lt;class 'langchain_core.messages.ai.OutputTokenDetails'&gt;,
                                                                                                                                                                                            'computed_fields': [],
                                                                                                                                                                                            'config': {'extra_fields_behavior': 'allow',
                                                                                                                                                                                                       'title': 'OutputTokenDetails'},
                                                                                                                                                                                            'extra_behavior': 'allow',
                                                                                                                                                                                            'fields': {'audio': {'metadata': {},
                                                                                                                                                                                                                 'required': False,
                                                                                                                                                                                                                 'schema': {'type': 'int'},
                                                                                                                                                                                                                 'type': 'typed-dict-field'},
                                                                                                                                                                                                       'reasoning': {'metadata': {},
                                                                                                                                                                                                                     'required': False,
                                                                                                                                                                                                                     'schema': {'type': 'int'},
                                                                                                                                                                                                                     'type': 'typed-dict-field'}},
                                                                                                                                                                                            'ref': 'langchain_core.messages.ai.OutputTokenDetails:1597346561296',
                                                                                                                                                                                            'type': 'typed-dict'},
                                                                                                                                                                                 'type': 'typed-dict-field'},
                                                                                                                                                        'output_tokens': {'metadata': {},
                                                                                                                                                                          'required': True,
                                                                                                                                                                          'schema': {'type': 'int'},
                                                                                                                                                                          'type': 'typed-dict-field'},
                                                                                                                                                        'total_tokens': {'metadata': {},
                                                                                                                                                                         'required': True,
                                                                                                                                                                         'schema': {'type': 'int'},
                                                                                                                                                                         'type': 'typed-dict-field'}},
                                                                                                                                             'ref': 'langchain_core.messages.ai.UsageMetadata:1597346557328',
                                                                                                                                             'type': 'typed-dict'},
                                                                                                                                  'type': 'nullable'},
                                                                                                                       'type': 'default'},
                                                                                                            'type': 'model-field'}},
                                                                              'model_name': 'AIMessage',
                                                                              'type': 'model-fields'},
                                                                   'type': 'function-before'},
                                                        'type': 'model'},
 'langchain_core.messages.ai.AIMessageChunk:1597346566256': {'function': {'function': &lt;function AIMessageChunk.init_server_tool_calls at 0x00000173EC810B80&gt;,
                                                                          'type': 'no-info'},
                                                             'metadata': {'pydantic_js_functions': [&lt;bound method BaseModel.__get_pydantic_json_schema__ of &lt;class 'langchain_core.messages.ai.AIMessageChunk'&gt;&gt;]},
                                                             'ref': 'langchain_core.messages.ai.AIMessageChunk:1597346566256',
                                                             'schema': {'function': {'function': &lt;function AIMessageChunk.init_tool_calls at 0x00000173EC8CB420&gt;,
                                                                                     'type': 'no-info'},
                                                                        'schema': {'cls': &lt;class 'langchain_core.messages.ai.AIMessageChunk'&gt;,
                                                                                   'config': {'extra_fields_behavior': 'allow',
                                                                                              'title': 'AIMessageChunk'},
                                                                                   'custom_init': True,
                                                                                   'root_model': False,
                                                                                   'schema': {'function': {'function': &lt;bound method AIMessage._backwards_compat_tool_calls of &lt;class 'langchain_core.messages.ai.AIMessageChunk'&gt;&gt;,
                                                                                                           'type': 'no-info'},
                                                                                              'schema': {'computed_fields': [],
                                                                                                         'fields': {'additional_kwargs': {'metadata': {},
                                                                                                                                          'schema': {'default_factory': &lt;class 'dict'&gt;,
                                                                                                                                                     'default_factory_takes_data': False,
                                                                                                                                                     'schema': {'keys_schema': {'type': 'any'},
                                                                                                                                                                'type': 'dict',
                                                                                                                                                                'values_schema': {'type': 'any'}},
                                                                                                                                                     'type': 'default'},
                                                                                                                                          'type': 'model-field'},
                                                                                                                    'chunk_position': {'metadata': {},
                                                                                                                                       'schema': {'default': None,
                                                                                                                                                  'schema': {'schema': {'expected': ['last'],
                                                                                                                                                                        'type': 'literal'},
                                                                                                                                                             'type': 'nullable'},
                                                                                                                                                  'type': 'default'},
                                                                                                                                       'type': 'model-field'},
                                                                                                                    'content': {'metadata': {},
                                                                                                                                'schema': {'choices': [{'type': 'str'},
                                                                                                                                                       {'items_schema': {'choices': [{'type': 'str'},
                                                                                                                                                                                     {'keys_schema': {'type': 'any'},
                                                                                                                                                                                      'type': 'dict',
                                                                                                                                                                                      'values_schema': {'type': 'any'}}],
                                                                                                                                                                         'type': 'union'},
                                                                                                                                                        'type': 'list'}],
                                                                                                                                           'type': 'union'},
                                                                                                                                'type': 'model-field'},
                                                                                                                    'id': {'metadata': {},
                                                                                                                           'schema': {'default': None,
                                                                                                                                      'schema': {'schema': {'coerce_numbers_to_str': True,
                                                                                                                                                            'type': 'str'},
                                                                                                                                                 'type': 'nullable'},
                                                                                                                                      'type': 'default'},
                                                                                                                           'type': 'model-field'},
                                                                                                                    'invalid_tool_calls': {'metadata': {},
                                                                                                                                           'schema': {'default': [],
                                                                                                                                                      'schema': {'items_schema': {'cls': &lt;class 'langchain_core.messages.content.InvalidToolCall'&gt;,
                                                                                                                                                                                  'computed_fields': [],
                                                                                                                                                                                  'config': {'extra_fields_behavior': 'allow',
                                                                                                                                                                                             'title': 'InvalidToolCall'},
                                                                                                                                                                                  'extra_behavior': 'allow',
                                                                                                                                                                                  'fields': {'args': {'metadata': {},
                                                                                                                                                                                                      'required': True,
                                                                                                                                                                                                      'schema': {'schema': {'type': 'str'},
                                                                                                                                                                                                                 'type': 'nullable'},
                                                                                                                                                                                                      'type': 'typed-dict-field'},
                                                                                                                                                                                             'error': {'metadata': {},
                                                                                                                                                                                                       'required': True,
                                                                                                                                                                                                       'schema': {'schema': {'type': 'str'},
                                                                                                                                                                                                                  'type': 'nullable'},
                                                                                                                                                                                                       'type': 'typed-dict-field'},
                                                                                                                                                                                             'extras': {'metadata': {},
                                                                                                                                                                                                        'required': False,
                                                                                                                                                                                                        'schema': {'keys_schema': {'type': 'str'},
                                                                                                                                                                                                                   'type': 'dict',
                                                                                                                                                                                                                   'values_schema': {'type': 'any'}},
                                                                                                                                                                                                        'type': 'typed-dict-field'},
                                                                                                                                                                                             'id': {'metadata': {},
                                                                                                                                                                                                    'required': True,
                                                                                                                                                                                                    'schema': {'schema': {'type': 'str'},
                                                                                                                                                                                                               'type': 'nullable'},
                                                                                                                                                                                                    'type': 'typed-dict-field'},
                                                                                                                                                                                             'index': {'metadata': {},
                                                                                                                                                                                                       'required': False,
                                                                                                                                                                                                       'schema': {'choices': [{'type': 'int'},
                                                                                                                                                                                                                              {'type': 'str'}],
                                                                                                                                                                                                                  'type': 'union'},
                                                                                                                                                                                                       'type': 'typed-dict-field'},
                                                                                                                                                                                             'name': {'metadata': {},
                                                                                                                                                                                                      'required': True,
                                                                                                                                                                                                      'schema': {'schema': {'type': 'str'},
                                                                                                                                                                                                                 'type': 'nullable'},
                                                                                                                                                                                                      'type': 'typed-dict-field'},
                                                                                                                                                                                             'type': {'metadata': {},
                                                                                                                                                                                                      'required': True,
                                                                                                                                                                                                      'schema': {'expected': ['invalid_tool_call'],
                                                                                                                                                                                                                 'type': 'literal'},
                                                                                                                                                                                                      'type': 'typed-dict-field'}},
                                                                                                                                                                                  'ref': 'langchain_core.messages.content.InvalidToolCall:1597346642640',
                                                                                                                                                                                  'type': 'typed-dict'},
                                                                                                                                                                 'type': 'list'},
                                                                                                                                                      'type': 'default'},
                                                                                                                                           'type': 'model-field'},
                                                                                                                    'name': {'metadata': {},
                                                                                                                             'schema': {'default': None,
                                                                                                                                        'schema': {'schema': {'type': 'str'},
                                                                                                                                                   'type': 'nullable'},
                                                                                                                                        'type': 'default'},
                                                                                                                             'type': 'model-field'},
                                                                                                                    'response_metadata': {'metadata': {},
                                                                                                                                          'schema': {'default_factory': &lt;class 'dict'&gt;,
                                                                                                                                                     'default_factory_takes_data': False,
                                                                                                                                                     'schema': {'keys_schema': {'type': 'any'},
                                                                                                                                                                'type': 'dict',
                                                                                                                                                                'values_schema': {'type': 'any'}},
                                                                                                                                                     'type': 'default'},
                                                                                                                                          'type': 'model-field'},
                                                                                                                    'tool_call_chunks': {'metadata': {},
                                                                                                                                         'schema': {'default': [],
                                                                                                                                                    'schema': {'items_schema': {'cls': &lt;class 'langchain_core.messages.tool.ToolCallChunk'&gt;,
                                                                                                                                                                                'computed_fields': [],
                                                                                                                                                                                'config': {'extra_fields_behavior': 'allow',
                                                                                                                                                                                           'title': 'ToolCallChunk'},
                                                                                                                                                                                'extra_behavior': 'allow',
                                                                                                                                                                                'fields': {'args': {'metadata': {},
                                                                                                                                                                                                    'required': True,
                                                                                                                                                                                                    'schema': {'schema': {'type': 'str'},
                                                                                                                                                                                                               'type': 'nullable'},
                                                                                                                                                                                                    'type': 'typed-dict-field'},
                                                                                                                                                                                           'id': {'metadata': {},
                                                                                                                                                                                                  'required': True,
                                                                                                                                                                                                  'schema': {'schema': {'type': 'str'},
                                                                                                                                                                                                             'type': 'nullable'},
                                                                                                                                                                                                  'type': 'typed-dict-field'},
                                                                                                                                                                                           'index': {'metadata': {},
                                                                                                                                                                                                     'required': True,
                                                                                                                                                                                                     'schema': {'schema': {'type': 'int'},
                                                                                                                                                                                                                'type': 'nullable'},
                                                                                                                                                                                                     'type': 'typed-dict-field'},
                                                                                                                                                                                           'name': {'metadata': {},
                                                                                                                                                                                                    'required': True,
                                                                                                                                                                                                    'schema': {'schema': {'type': 'str'},
                                                                                                                                                                                                               'type': 'nullable'},
                                                                                                                                                                                                    'type': 'typed-dict-field'},
                                                                                                                                                                                           'type': {'metadata': {},
                                                                                                                                                                                                    'required': False,
                                                                                                                                                                                                    'schema': {'expected': ['tool_call_chunk'],
                                                                                                                                                                                                               'type': 'literal'},
                                                                                                                                                                                                    'type': 'typed-dict-field'}},
                                                                                                                                                                                'ref': 'langchain_core.messages.tool.ToolCallChunk:1597346534512',
                                                                                                                                                                                'type': 'typed-dict'},
                                                                                                                                                               'type': 'list'},
                                                                                                                                                    'type': 'default'},
                                                                                                                                         'type': 'model-field'},
                                                                                                                    'tool_calls': {'metadata': {},
                                                                                                                                   'schema': {'default': [],
                                                                                                                                              'schema': {'items_schema': {'cls': &lt;class 'langchain_core.messages.tool.ToolCall'&gt;,
                                                                                                                                                                          'computed_fields': [],
                                                                                                                                                                          'config': {'extra_fields_behavior': 'allow',
                                                                                                                                                                                     'title': 'ToolCall'},
                                                                                                                                                                          'extra_behavior': 'allow',
                                                                                                                                                                          'fields': {'args': {'metadata': {},
                                                                                                                                                                                              'required': True,
                                                                                                                                                                                              'schema': {'keys_schema': {'type': 'str'},
                                                                                                                                                                                                         'type': 'dict',
                                                                                                                                                                                                         'values_schema': {'type': 'any'}},
                                                                                                                                                                                              'type': 'typed-dict-field'},
                                                                                                                                                                                     'id': {'metadata': {},
                                                                                                                                                                                            'required': True,
                                                                                                                                                                                            'schema': {'schema': {'type': 'str'},
                                                                                                                                                                                                       'type': 'nullable'},
                                                                                                                                                                                            'type': 'typed-dict-field'},
                                                                                                                                                                                     'name': {'metadata': {},
                                                                                                                                                                                              'required': True,
                                                                                                                                                                                              'schema': {'type': 'str'},
                                                                                                                                                                                              'type': 'typed-dict-field'},
                                                                                                                                                                                     'type': {'metadata': {},
                                                                                                                                                                                              'required': False,
                                                                                                                                                                                              'schema': {'expected': ['tool_call'],
                                                                                                                                                                                                         'type': 'literal'},
                                                                                                                                                                                              'type': 'typed-dict-field'}},
                                                                                                                                                                          'ref': 'langchain_core.messages.tool.ToolCall:1597346538480',
                                                                                                                                                                          'type': 'typed-dict'},
                                                                                                                                                         'type': 'list'},
                                                                                                                                              'type': 'default'},
                                                                                                                                   'type': 'model-field'},
                                                                                                                    'type': {'metadata': {},
                                                                                                                             'schema': {'default': 'AIMessageChunk',
                                                                                                                                        'schema': {'expected': ['AIMessageChunk'],
                                                                                                                                                   'type': 'literal'},
                                                                                                                                        'type': 'default'},
                                                                                                                             'type': 'model-field'},
                                                                                                                    'usage_metadata': {'metadata': {},
                                                                                                                                       'schema': {'default': None,
                                                                                                                                                  'schema': {'schema': {'cls': &lt;class 'langchain_core.messages.ai.UsageMetadata'&gt;,
                                                                                                                                                                        'computed_fields': [],
                                                                                                                                                                        'config': {'extra_fields_behavior': 'allow',
                                                                                                                                                                                   'title': 'UsageMetadata'},
                                                                                                                                                                        'extra_behavior': 'allow',
                                                                                                                                                                        'fields': {'input_token_details': {'metadata': {},
                                                                                                                                                                                                           'required': False,
                                                                                                                                                                                                           'schema': {'cls': &lt;class 'langchain_core.messages.ai.InputTokenDetails'&gt;,
                                                                                                                                                                                                                      'computed_fields': [],
                                                                                                                                                                                                                      'config': {'extra_fields_behavior': 'allow',
                                                                                                                                                                                                                                 'title': 'InputTokenDetails'},
                                                                                                                                                                                                                      'extra_behavior': 'allow',
                                                                                                                                                                                                                      'fields': {'audio': {'metadata': {},
                                                                                                                                                                                                                                           'required': False,
                                                                                                                                                                                                                                           'schema': {'type': 'int'},
                                                                                                                                                                                                                                           'type': 'typed-dict-field'},
                                                                                                                                                                                                                                 'cache_creation': {'metadata': {},
                                                                                                                                                                                                                                                    'required': False,
                                                                                                                                                                                                                                                    'schema': {'type': 'int'},
                                                                                                                                                                                                                                                    'type': 'typed-dict-field'},
                                                                                                                                                                                                                                 'cache_read': {'metadata': {},
                                                                                                                                                                                                                                                'required': False,
                                                                                                                                                                                                                                                'schema': {'type': 'int'},
                                                                                                                                                                                                                                                'type': 'typed-dict-field'}},
                                                                                                                                                                                                                      'ref': 'langchain_core.messages.ai.InputTokenDetails:1597346536496',
                                                                                                                                                                                                                      'type': 'typed-dict'},
                                                                                                                                                                                                           'type': 'typed-dict-field'},
                                                                                                                                                                                   'input_tokens': {'metadata': {},
                                                                                                                                                                                                    'required': True,
                                                                                                                                                                                                    'schema': {'type': 'int'},
                                                                                                                                                                                                    'type': 'typed-dict-field'},
                                                                                                                                                                                   'output_token_details': {'metadata': {},
                                                                                                                                                                                                            'required': False,
                                                                                                                                                                                                            'schema': {'cls': &lt;class 'langchain_core.messages.ai.OutputTokenDetails'&gt;,
                                                                                                                                                                                                                       'computed_fields': [],
                                                                                                                                                                                                                       'config': {'extra_fields_behavior': 'allow',
                                                                                                                                                                                                                                  'title': 'OutputTokenDetails'},
                                                                                                                                                                                                                       'extra_behavior': 'allow',
                                                                                                                                                                                                                       'fields': {'audio': {'metadata': {},
                                                                                                                                                                                                                                            'required': False,
                                                                                                                                                                                                                                            'schema': {'type': 'int'},
                                                                                                                                                                                                                                            'type': 'typed-dict-field'},
                                                                                                                                                                                                                                  'reasoning': {'metadata': {},
                                                                                                                                                                                                                                                'required': False,
                                                                                                                                                                                                                                                'schema': {'type': 'int'},
                                                                                                                                                                                                                                                'type': 'typed-dict-field'}},
                                                                                                                                                                                                                       'ref': 'langchain_core.messages.ai.OutputTokenDetails:1597346561296',
                                                                                                                                                                                                                       'type': 'typed-dict'},
                                                                                                                                                                                                            'type': 'typed-dict-field'},
                                                                                                                                                                                   'output_tokens': {'metadata': {},
                                                                                                                                                                                                     'required': True,
                                                                                                                                                                                                     'schema': {'type': 'int'},
                                                                                                                                                                                                     'type': 'typed-dict-field'},
                                                                                                                                                                                   'total_tokens': {'metadata': {},
                                                                                                                                                                                                    'required': True,
                                                                                                                                                                                                    'schema': {'type': 'int'},
                                                                                                                                                                                                    'type': 'typed-dict-field'}},
                                                                                                                                                                        'ref': 'langchain_core.messages.ai.UsageMetadata:1597346557328',
                                                                                                                                                                        'type': 'typed-dict'},
                                                                                                                                                             'type': 'nullable'},
                                                                                                                                                  'type': 'default'},
                                                                                                                                       'type': 'model-field'}},
                                                                                                         'model_name': 'AIMessageChunk',
                                                                                                         'type': 'model-fields'},
                                                                                              'type': 'function-before'},
                                                                                   'type': 'model'},
                                                                        'type': 'function-after'},
                                                             'type': 'function-after'},
 'langchain_core.messages.chat.ChatMessage:1597346573200': {'cls': &lt;class 'langchain_core.messages.chat.ChatMessage'&gt;,
                                                            'config': {'extra_fields_behavior': 'allow',
                                                                       'title': 'ChatMessage'},
                                                            'custom_init': True,
                                                            'metadata': {'pydantic_js_functions': [&lt;bound method BaseModel.__get_pydantic_json_schema__ of &lt;class 'langchain_core.messages.chat.ChatMessage'&gt;&gt;]},
                                                            'ref': 'langchain_core.messages.chat.ChatMessage:1597346573200',
                                                            'root_model': False,
                                                            'schema': {'computed_fields': [],
                                                                       'fields': {'additional_kwargs': {'metadata': {},
                                                                                                        'schema': {'default_factory': &lt;class 'dict'&gt;,
                                                                                                                   'default_factory_takes_data': False,
                                                                                                                   'schema': {'keys_schema': {'type': 'any'},
                                                                                                                              'type': 'dict',
                                                                                                                              'values_schema': {'type': 'any'}},
                                                                                                                   'type': 'default'},
                                                                                                        'type': 'model-field'},
                                                                                  'content': {'metadata': {},
                                                                                              'schema': {'choices': [{'type': 'str'},
                                                                                                                     {'items_schema': {'choices': [{'type': 'str'},
                                                                                                                                                   {'keys_schema': {'type': 'any'},
                                                                                                                                                    'type': 'dict',
                                                                                                                                                    'values_schema': {'type': 'any'}}],
                                                                                                                                       'type': 'union'},
                                                                                                                      'type': 'list'}],
                                                                                                         'type': 'union'},
                                                                                              'type': 'model-field'},
                                                                                  'id': {'metadata': {},
                                                                                         'schema': {'default': None,
                                                                                                    'schema': {'schema': {'coerce_numbers_to_str': True,
                                                                                                                          'type': 'str'},
                                                                                                               'type': 'nullable'},
                                                                                                    'type': 'default'},
                                                                                         'type': 'model-field'},
                                                                                  'name': {'metadata': {},
                                                                                           'schema': {'default': None,
                                                                                                      'schema': {'schema': {'type': 'str'},
                                                                                                                 'type': 'nullable'},
                                                                                                      'type': 'default'},
                                                                                           'type': 'model-field'},
                                                                                  'response_metadata': {'metadata': {},
                                                                                                        'schema': {'default_factory': &lt;class 'dict'&gt;,
                                                                                                                   'default_factory_takes_data': False,
                                                                                                                   'schema': {'keys_schema': {'type': 'any'},
                                                                                                                              'type': 'dict',
                                                                                                                              'values_schema': {'type': 'any'}},
                                                                                                                   'type': 'default'},
                                                                                                        'type': 'model-field'},
                                                                                  'role': {'metadata': {},
                                                                                           'schema': {'type': 'str'},
                                                                                           'type': 'model-field'},
                                                                                  'type': {'metadata': {},
                                                                                           'schema': {'default': 'chat',
                                                                                                      'schema': {'expected': ['chat'],
                                                                                                                 'type': 'literal'},
                                                                                                      'type': 'default'},
                                                                                           'type': 'model-field'}},
                                                                       'model_name': 'ChatMessage',
                                                                       'type': 'model-fields'},
                                                            'type': 'model'},
 'langchain_core.messages.chat.ChatMessageChunk:1597346576176': {'cls': &lt;class 'langchain_core.messages.chat.ChatMessageChunk'&gt;,
                                                                 'config': {'extra_fields_behavior': 'allow',
                                                                            'title': 'ChatMessageChunk'},
                                                                 'custom_init': True,
                                                                 'metadata': {'pydantic_js_functions': [&lt;bound method BaseModel.__get_pydantic_json_schema__ of &lt;class 'langchain_core.messages.chat.ChatMessageChunk'&gt;&gt;]},
                                                                 'ref': 'langchain_core.messages.chat.ChatMessageChunk:1597346576176',
                                                                 'root_model': False,
                                                                 'schema': {'computed_fields': [],
                                                                            'fields': {'additional_kwargs': {'metadata': {},
                                                                                                             'schema': {'default_factory': &lt;class 'dict'&gt;,
                                                                                                                        'default_factory_takes_data': False,
                                                                                                                        'schema': {'keys_schema': {'type': 'any'},
                                                                                                                                   'type': 'dict',
                                                                                                                                   'values_schema': {'type': 'any'}},
                                                                                                                        'type': 'default'},
                                                                                                             'type': 'model-field'},
                                                                                       'content': {'metadata': {},
                                                                                                   'schema': {'choices': [{'type': 'str'},
                                                                                                                          {'items_schema': {'choices': [{'type': 'str'},
                                                                                                                                                        {'keys_schema': {'type': 'any'},
                                                                                                                                                         'type': 'dict',
                                                                                                                                                         'values_schema': {'type': 'any'}}],
                                                                                                                                            'type': 'union'},
                                                                                                                           'type': 'list'}],
                                                                                                              'type': 'union'},
                                                                                                   'type': 'model-field'},
                                                                                       'id': {'metadata': {},
                                                                                              'schema': {'default': None,
                                                                                                         'schema': {'schema': {'coerce_numbers_to_str': True,
                                                                                                                               'type': 'str'},
                                                                                                                    'type': 'nullable'},
                                                                                                         'type': 'default'},
                                                                                              'type': 'model-field'},
                                                                                       'name': {'metadata': {},
                                                                                                'schema': {'default': None,
                                                                                                           'schema': {'schema': {'type': 'str'},
                                                                                                                      'type': 'nullable'},
                                                                                                           'type': 'default'},
                                                                                                'type': 'model-field'},
                                                                                       'response_metadata': {'metadata': {},
                                                                                                             'schema': {'default_factory': &lt;class 'dict'&gt;,
                                                                                                                        'default_factory_takes_data': False,
                                                                                                                        'schema': {'keys_schema': {'type': 'any'},
                                                                                                                                   'type': 'dict',
                                                                                                                                   'values_schema': {'type': 'any'}},
                                                                                                                        'type': 'default'},
                                                                                                             'type': 'model-field'},
                                                                                       'role': {'metadata': {},
                                                                                                'schema': {'type': 'str'},
                                                                                                'type': 'model-field'},
                                                                                       'type': {'metadata': {},
                                                                                                'schema': {'default': 'ChatMessageChunk',
                                                                                                           'schema': {'expected': ['ChatMessageChunk'],
                                                                                                                      'type': 'literal'},
                                                                                                           'type': 'default'},
                                                                                                'type': 'model-field'}},
                                                                            'model_name': 'ChatMessageChunk',
                                                                            'type': 'model-fields'},
                                                                 'type': 'model'},
 'langchain_core.messages.function.FunctionMessage:1597346554352': {'cls': &lt;class 'langchain_core.messages.function.FunctionMessage'&gt;,
                                                                    'config': {'extra_fields_behavior': 'allow',
                                                                               'title': 'FunctionMessage'},
                                                                    'custom_init': True,
                                                                    'metadata': {'pydantic_js_functions': [&lt;bound method BaseModel.__get_pydantic_json_schema__ of &lt;class 'langchain_core.messages.function.FunctionMessage'&gt;&gt;]},
                                                                    'ref': 'langchain_core.messages.function.FunctionMessage:1597346554352',
                                                                    'root_model': False,
                                                                    'schema': {'computed_fields': [],
                                                                               'fields': {'additional_kwargs': {'metadata': {},
                                                                                                                'schema': {'default_factory': &lt;class 'dict'&gt;,
                                                                                                                           'default_factory_takes_data': False,
                                                                                                                           'schema': {'keys_schema': {'type': 'any'},
                                                                                                                                      'type': 'dict',
                                                                                                                                      'values_schema': {'type': 'any'}},
                                                                                                                           'type': 'default'},
                                                                                                                'type': 'model-field'},
                                                                                          'content': {'metadata': {},
                                                                                                      'schema': {'choices': [{'type': 'str'},
                                                                                                                             {'items_schema': {'choices': [{'type': 'str'},
                                                                                                                                                           {'keys_schema': {'type': 'any'},
                                                                                                                                                            'type': 'dict',
                                                                                                                                                            'values_schema': {'type': 'any'}}],
                                                                                                                                               'type': 'union'},
                                                                                                                              'type': 'list'}],
                                                                                                                 'type': 'union'},
                                                                                                      'type': 'model-field'},
                                                                                          'id': {'metadata': {},
                                                                                                 'schema': {'default': None,
                                                                                                            'schema': {'schema': {'coerce_numbers_to_str': True,
                                                                                                                                  'type': 'str'},
                                                                                                                       'type': 'nullable'},
                                                                                                            'type': 'default'},
                                                                                                 'type': 'model-field'},
                                                                                          'name': {'metadata': {},
                                                                                                   'schema': {'type': 'str'},
                                                                                                   'type': 'model-field'},
                                                                                          'response_metadata': {'metadata': {},
                                                                                                                'schema': {'default_factory': &lt;class 'dict'&gt;,
                                                                                                                           'default_factory_takes_data': False,
                                                                                                                           'schema': {'keys_schema': {'type': 'any'},
                                                                                                                                      'type': 'dict',
                                                                                                                                      'values_schema': {'type': 'any'}},
                                                                                                                           'type': 'default'},
                                                                                                                'type': 'model-field'},
                                                                                          'type': {'metadata': {},
                                                                                                   'schema': {'default': 'function',
                                                                                                              'schema': {'expected': ['function'],
                                                                                                                         'type': 'literal'},
                                                                                                              'type': 'default'},
                                                                                                   'type': 'model-field'}},
                                                                               'model_name': 'FunctionMessage',
                                                                               'type': 'model-fields'},
                                                                    'type': 'model'},
 'langchain_core.messages.function.FunctionMessageChunk:1597346564272': {'cls': &lt;class 'langchain_core.messages.function.FunctionMessageChunk'&gt;,
                                                                         'config': {'extra_fields_behavior': 'allow',
                                                                                    'title': 'FunctionMessageChunk'},
                                                                         'custom_init': True,
                                                                         'metadata': {'pydantic_js_functions': [&lt;bound method BaseModel.__get_pydantic_json_schema__ of &lt;class 'langchain_core.messages.function.FunctionMessageChunk'&gt;&gt;]},
                                                                         'ref': 'langchain_core.messages.function.FunctionMessageChunk:1597346564272',
                                                                         'root_model': False,
                                                                         'schema': {'computed_fields': [],
                                                                                    'fields': {'additional_kwargs': {'metadata': {},
                                                                                                                     'schema': {'default_factory': &lt;class 'dict'&gt;,
                                                                                                                                'default_factory_takes_data': False,
                                                                                                                                'schema': {'keys_schema': {'type': 'any'},
                                                                                                                                           'type': 'dict',
                                                                                                                                           'values_schema': {'type': 'any'}},
                                                                                                                                'type': 'default'},
                                                                                                                     'type': 'model-field'},
                                                                                               'content': {'metadata': {},
                                                                                                           'schema': {'choices': [{'type': 'str'},
                                                                                                                                  {'items_schema': {'choices': [{'type': 'str'},
                                                                                                                                                                {'keys_schema': {'type': 'any'},
                                                                                                                                                                 'type': 'dict',
                                                                                                                                                                 'values_schema': {'type': 'any'}}],
                                                                                                                                                    'type': 'union'},
                                                                                                                                   'type': 'list'}],
                                                                                                                      'type': 'union'},
                                                                                                           'type': 'model-field'},
                                                                                               'id': {'metadata': {},
                                                                                                      'schema': {'default': None,
                                                                                                                 'schema': {'schema': {'coerce_numbers_to_str': True,
                                                                                                                                       'type': 'str'},
                                                                                                                            'type': 'nullable'},
                                                                                                                 'type': 'default'},
                                                                                                      'type': 'model-field'},
                                                                                               'name': {'metadata': {},
                                                                                                        'schema': {'type': 'str'},
                                                                                                        'type': 'model-field'},
                                                                                               'response_metadata': {'metadata': {},
                                                                                                                     'schema': {'default_factory': &lt;class 'dict'&gt;,
                                                                                                                                'default_factory_takes_data': False,
                                                                                                                                'schema': {'keys_schema': {'type': 'any'},
                                                                                                                                           'type': 'dict',
                                                                                                                                           'values_schema': {'type': 'any'}},
                                                                                                                                'type': 'default'},
                                                                                                                     'type': 'model-field'},
                                                                                               'type': {'metadata': {},
                                                                                                        'schema': {'default': 'FunctionMessageChunk',
                                                                                                                   'schema': {'expected': ['FunctionMessageChunk'],
                                                                                                                              'type': 'literal'},
                                                                                                                   'type': 'default'},
                                                                                                        'type': 'model-field'}},
                                                                                    'model_name': 'FunctionMessageChunk',
                                                                                    'type': 'model-fields'},
                                                                         'type': 'model'},
 'langchain_core.messages.human.HumanMessage:1597346558320': {'cls': &lt;class 'langchain_core.messages.human.HumanMessage'&gt;,
                                                              'config': {'extra_fields_behavior': 'allow',
                                                                         'title': 'HumanMessage'},
                                                              'custom_init': True,
                                                              'metadata': {'pydantic_js_functions': [&lt;bound method BaseModel.__get_pydantic_json_schema__ of &lt;class 'langchain_core.messages.human.HumanMessage'&gt;&gt;]},
                                                              'ref': 'langchain_core.messages.human.HumanMessage:1597346558320',
                                                              'root_model': False,
                                                              'schema': {'computed_fields': [],
                                                                         'fields': {'additional_kwargs': {'metadata': {},
                                                                                                          'schema': {'default_factory': &lt;class 'dict'&gt;,
                                                                                                                     'default_factory_takes_data': False,
                                                                                                                     'schema': {'keys_schema': {'type': 'any'},
                                                                                                                                'type': 'dict',
                                                                                                                                'values_schema': {'type': 'any'}},
                                                                                                                     'type': 'default'},
                                                                                                          'type': 'model-field'},
                                                                                    'content': {'metadata': {},
                                                                                                'schema': {'choices': [{'type': 'str'},
                                                                                                                       {'items_schema': {'choices': [{'type': 'str'},
                                                                                                                                                     {'keys_schema': {'type': 'any'},
                                                                                                                                                      'type': 'dict',
                                                                                                                                                      'values_schema': {'type': 'any'}}],
                                                                                                                                         'type': 'union'},
                                                                                                                        'type': 'list'}],
                                                                                                           'type': 'union'},
                                                                                                'type': 'model-field'},
                                                                                    'id': {'metadata': {},
                                                                                           'schema': {'default': None,
                                                                                                      'schema': {'schema': {'coerce_numbers_to_str': True,
                                                                                                                            'type': 'str'},
                                                                                                                 'type': 'nullable'},
                                                                                                      'type': 'default'},
                                                                                           'type': 'model-field'},
                                                                                    'name': {'metadata': {},
                                                                                             'schema': {'default': None,
                                                                                                        'schema': {'schema': {'type': 'str'},
                                                                                                                   'type': 'nullable'},
                                                                                                        'type': 'default'},
                                                                                             'type': 'model-field'},
                                                                                    'response_metadata': {'metadata': {},
                                                                                                          'schema': {'default_factory': &lt;class 'dict'&gt;,
                                                                                                                     'default_factory_takes_data': False,
                                                                                                                     'schema': {'keys_schema': {'type': 'any'},
                                                                                                                                'type': 'dict',
                                                                                                                                'values_schema': {'type': 'any'}},
                                                                                                                     'type': 'default'},
                                                                                                          'type': 'model-field'},
                                                                                    'type': {'metadata': {},
                                                                                             'schema': {'default': 'human',
                                                                                                        'schema': {'expected': ['human'],
                                                                                                                   'type': 'literal'},
                                                                                                        'type': 'default'},
                                                                                             'type': 'model-field'}},
                                                                         'model_name': 'HumanMessage',
                                                                         'type': 'model-fields'},
                                                              'type': 'model'},
 'langchain_core.messages.human.HumanMessageChunk:1597346553360': {'cls': &lt;class 'langchain_core.messages.human.HumanMessageChunk'&gt;,
                                                                   'config': {'extra_fields_behavior': 'allow',
                                                                              'title': 'HumanMessageChunk'},
                                                                   'custom_init': True,
                                                                   'metadata': {'pydantic_js_functions': [&lt;bound method BaseModel.__get_pydantic_json_schema__ of &lt;class 'langchain_core.messages.human.HumanMessageChunk'&gt;&gt;]},
                                                                   'ref': 'langchain_core.messages.human.HumanMessageChunk:1597346553360',
                                                                   'root_model': False,
                                                                   'schema': {'computed_fields': [],
                                                                              'fields': {'additional_kwargs': {'metadata': {},
                                                                                                               'schema': {'default_factory': &lt;class 'dict'&gt;,
                                                                                                                          'default_factory_takes_data': False,
                                                                                                                          'schema': {'keys_schema': {'type': 'any'},
                                                                                                                                     'type': 'dict',
                                                                                                                                     'values_schema': {'type': 'any'}},
                                                                                                                          'type': 'default'},
                                                                                                               'type': 'model-field'},
                                                                                         'content': {'metadata': {},
                                                                                                     'schema': {'choices': [{'type': 'str'},
                                                                                                                            {'items_schema': {'choices': [{'type': 'str'},
                                                                                                                                                          {'keys_schema': {'type': 'any'},
                                                                                                                                                           'type': 'dict',
                                                                                                                                                           'values_schema': {'type': 'any'}}],
                                                                                                                                              'type': 'union'},
                                                                                                                             'type': 'list'}],
                                                                                                                'type': 'union'},
                                                                                                     'type': 'model-field'},
                                                                                         'id': {'metadata': {},
                                                                                                'schema': {'default': None,
                                                                                                           'schema': {'schema': {'coerce_numbers_to_str': True,
                                                                                                                                 'type': 'str'},
                                                                                                                      'type': 'nullable'},
                                                                                                           'type': 'default'},
                                                                                                'type': 'model-field'},
                                                                                         'name': {'metadata': {},
                                                                                                  'schema': {'default': None,
                                                                                                             'schema': {'schema': {'type': 'str'},
                                                                                                                        'type': 'nullable'},
                                                                                                             'type': 'default'},
                                                                                                  'type': 'model-field'},
                                                                                         'response_metadata': {'metadata': {},
                                                                                                               'schema': {'default_factory': &lt;class 'dict'&gt;,
                                                                                                                          'default_factory_takes_data': False,
                                                                                                                          'schema': {'keys_schema': {'type': 'any'},
                                                                                                                                     'type': 'dict',
                                                                                                                                     'values_schema': {'type': 'any'}},
                                                                                                                          'type': 'default'},
                                                                                                               'type': 'model-field'},
                                                                                         'type': {'metadata': {},
                                                                                                  'schema': {'default': 'HumanMessageChunk',
                                                                                                             'schema': {'expected': ['HumanMessageChunk'],
                                                                                                                        'type': 'literal'},
                                                                                                             'type': 'default'},
                                                                                                  'type': 'model-field'}},
                                                                              'model_name': 'HumanMessageChunk',
                                                                              'type': 'model-fields'},
                                                                   'type': 'model'},
 'langchain_core.messages.system.SystemMessage:1597346577168': {'cls': &lt;class 'langchain_core.messages.system.SystemMessage'&gt;,
                                                                'config': {'extra_fields_behavior': 'allow',
                                                                           'title': 'SystemMessage'},
                                                                'custom_init': True,
                                                                'metadata': {'pydantic_js_functions': [&lt;bound method BaseModel.__get_pydantic_json_schema__ of &lt;class 'langchain_core.messages.system.SystemMessage'&gt;&gt;]},
                                                                'ref': 'langchain_core.messages.system.SystemMessage:1597346577168',
                                                                'root_model': False,
                                                                'schema': {'computed_fields': [],
                                                                           'fields': {'additional_kwargs': {'metadata': {},
                                                                                                            'schema': {'default_factory': &lt;class 'dict'&gt;,
                                                                                                                       'default_factory_takes_data': False,
                                                                                                                       'schema': {'keys_schema': {'type': 'any'},
                                                                                                                                  'type': 'dict',
                                                                                                                                  'values_schema': {'type': 'any'}},
                                                                                                                       'type': 'default'},
                                                                                                            'type': 'model-field'},
                                                                                      'content': {'metadata': {},
                                                                                                  'schema': {'choices': [{'type': 'str'},
                                                                                                                         {'items_schema': {'choices': [{'type': 'str'},
                                                                                                                                                       {'keys_schema': {'type': 'any'},
                                                                                                                                                        'type': 'dict',
                                                                                                                                                        'values_schema': {'type': 'any'}}],
                                                                                                                                           'type': 'union'},
                                                                                                                          'type': 'list'}],
                                                                                                             'type': 'union'},
                                                                                                  'type': 'model-field'},
                                                                                      'id': {'metadata': {},
                                                                                             'schema': {'default': None,
                                                                                                        'schema': {'schema': {'coerce_numbers_to_str': True,
                                                                                                                              'type': 'str'},
                                                                                                                   'type': 'nullable'},
                                                                                                        'type': 'default'},
                                                                                             'type': 'model-field'},
                                                                                      'name': {'metadata': {},
                                                                                               'schema': {'default': None,
                                                                                                          'schema': {'schema': {'type': 'str'},
                                                                                                                     'type': 'nullable'},
                                                                                                          'type': 'default'},
                                                                                               'type': 'model-field'},
                                                                                      'response_metadata': {'metadata': {},
                                                                                                            'schema': {'default_factory': &lt;class 'dict'&gt;,
                                                                                                                       'default_factory_takes_data': False,
                                                                                                                       'schema': {'keys_schema': {'type': 'any'},
                                                                                                                                  'type': 'dict',
                                                                                                                                  'values_schema': {'type': 'any'}},
                                                                                                                       'type': 'default'},
                                                                                                            'type': 'model-field'},
                                                                                      'type': {'metadata': {},
                                                                                               'schema': {'default': 'system',
                                                                                                          'schema': {'expected': ['system'],
                                                                                                                     'type': 'literal'},
                                                                                                          'type': 'default'},
                                                                                               'type': 'model-field'}},
                                                                           'model_name': 'SystemMessage',
                                                                           'type': 'model-fields'},
                                                                'type': 'model'},
 'langchain_core.messages.system.SystemMessageChunk:1597346584112': {'cls': &lt;class 'langchain_core.messages.system.SystemMessageChunk'&gt;,
                                                                     'config': {'extra_fields_behavior': 'allow',
                                                                                'title': 'SystemMessageChunk'},
                                                                     'custom_init': True,
                                                                     'metadata': {'pydantic_js_functions': [&lt;bound method BaseModel.__get_pydantic_json_schema__ of &lt;class 'langchain_core.messages.system.SystemMessageChunk'&gt;&gt;]},
                                                                     'ref': 'langchain_core.messages.system.SystemMessageChunk:1597346584112',
                                                                     'root_model': False,
                                                                     'schema': {'computed_fields': [],
                                                                                'fields': {'additional_kwargs': {'metadata': {},
                                                                                                                 'schema': {'default_factory': &lt;class 'dict'&gt;,
                                                                                                                            'default_factory_takes_data': False,
                                                                                                                            'schema': {'keys_schema': {'type': 'any'},
                                                                                                                                       'type': 'dict',
                                                                                                                                       'values_schema': {'type': 'any'}},
                                                                                                                            'type': 'default'},
                                                                                                                 'type': 'model-field'},
                                                                                           'content': {'metadata': {},
                                                                                                       'schema': {'choices': [{'type': 'str'},
                                                                                                                              {'items_schema': {'choices': [{'type': 'str'},
                                                                                                                                                            {'keys_schema': {'type': 'any'},
                                                                                                                                                             'type': 'dict',
                                                                                                                                                             'values_schema': {'type': 'any'}}],
                                                                                                                                                'type': 'union'},
                                                                                                                               'type': 'list'}],
                                                                                                                  'type': 'union'},
                                                                                                       'type': 'model-field'},
                                                                                           'id': {'metadata': {},
                                                                                                  'schema': {'default': None,
                                                                                                             'schema': {'schema': {'coerce_numbers_to_str': True,
                                                                                                                                   'type': 'str'},
                                                                                                                        'type': 'nullable'},
                                                                                                             'type': 'default'},
                                                                                                  'type': 'model-field'},
                                                                                           'name': {'metadata': {},
                                                                                                    'schema': {'default': None,
                                                                                                               'schema': {'schema': {'type': 'str'},
                                                                                                                          'type': 'nullable'},
                                                                                                               'type': 'default'},
                                                                                                    'type': 'model-field'},
                                                                                           'response_metadata': {'metadata': {},
                                                                                                                 'schema': {'default_factory': &lt;class 'dict'&gt;,
                                                                                                                            'default_factory_takes_data': False,
                                                                                                                            'schema': {'keys_schema': {'type': 'any'},
                                                                                                                                       'type': 'dict',
                                                                                                                                       'values_schema': {'type': 'any'}},
                                                                                                                            'type': 'default'},
                                                                                                                 'type': 'model-field'},
                                                                                           'type': {'metadata': {},
                                                                                                    'schema': {'default': 'SystemMessageChunk',
                                                                                                               'schema': {'expected': ['SystemMessageChunk'],
                                                                                                                          'type': 'literal'},
                                                                                                               'type': 'default'},
                                                                                                    'type': 'model-field'}},
                                                                                'model_name': 'SystemMessageChunk',
                                                                                'type': 'model-fields'},
                                                                     'type': 'model'},
 'langchain_core.messages.tool.ToolMessage:1597346539472': {'cls': &lt;class 'langchain_core.messages.tool.ToolMessage'&gt;,
                                                            'config': {'extra_fields_behavior': 'allow',
                                                                       'title': 'ToolMessage'},
                                                            'custom_init': True,
                                                            'metadata': {'pydantic_js_functions': [&lt;bound method BaseModel.__get_pydantic_json_schema__ of &lt;class 'langchain_core.messages.tool.ToolMessage'&gt;&gt;]},
                                                            'ref': 'langchain_core.messages.tool.ToolMessage:1597346539472',
                                                            'root_model': False,
                                                            'schema': {'function': {'function': &lt;bound method ToolMessage.coerce_args of &lt;class 'langchain_core.messages.tool.ToolMessage'&gt;&gt;,
                                                                                    'type': 'no-info'},
                                                                       'schema': {'computed_fields': [],
                                                                                  'fields': {'additional_kwargs': {'metadata': {},
                                                                                                                   'schema': {'default_factory': &lt;class 'dict'&gt;,
                                                                                                                              'default_factory_takes_data': False,
                                                                                                                              'schema': {'keys_schema': {'type': 'any'},
                                                                                                                                         'type': 'dict',
                                                                                                                                         'values_schema': {'type': 'any'}},
                                                                                                                              'type': 'default'},
                                                                                                                   'type': 'model-field'},
                                                                                             'artifact': {'metadata': {},
                                                                                                          'schema': {'default': None,
                                                                                                                     'schema': {'type': 'any'},
                                                                                                                     'type': 'default'},
                                                                                                          'type': 'model-field'},
                                                                                             'content': {'metadata': {},
                                                                                                         'schema': {'choices': [{'type': 'str'},
                                                                                                                                {'items_schema': {'choices': [{'type': 'str'},
                                                                                                                                                              {'keys_schema': {'type': 'any'},
                                                                                                                                                               'type': 'dict',
                                                                                                                                                               'values_schema': {'type': 'any'}}],
                                                                                                                                                  'type': 'union'},
                                                                                                                                 'type': 'list'}],
                                                                                                                    'type': 'union'},
                                                                                                         'type': 'model-field'},
                                                                                             'id': {'metadata': {},
                                                                                                    'schema': {'default': None,
                                                                                                               'schema': {'schema': {'coerce_numbers_to_str': True,
                                                                                                                                     'type': 'str'},
                                                                                                                          'type': 'nullable'},
                                                                                                               'type': 'default'},
                                                                                                    'type': 'model-field'},
                                                                                             'name': {'metadata': {},
                                                                                                      'schema': {'default': None,
                                                                                                                 'schema': {'schema': {'type': 'str'},
                                                                                                                            'type': 'nullable'},
                                                                                                                 'type': 'default'},
                                                                                                      'type': 'model-field'},
                                                                                             'response_metadata': {'metadata': {},
                                                                                                                   'schema': {'default_factory': &lt;class 'dict'&gt;,
                                                                                                                              'default_factory_takes_data': False,
                                                                                                                              'schema': {'keys_schema': {'type': 'any'},
                                                                                                                                         'type': 'dict',
                                                                                                                                         'values_schema': {'type': 'any'}},
                                                                                                                              'type': 'default'},
                                                                                                                   'type': 'model-field'},
                                                                                             'status': {'metadata': {},
                                                                                                        'schema': {'default': 'success',
                                                                                                                   'schema': {'expected': ['success',
                                                                                                                                           'error'],
                                                                                                                              'type': 'literal'},
                                                                                                                   'type': 'default'},
                                                                                                        'type': 'model-field'},
                                                                                             'tool_call_id': {'metadata': {},
                                                                                                              'schema': {'type': 'str'},
                                                                                                              'type': 'model-field'},
                                                                                             'type': {'metadata': {},
                                                                                                      'schema': {'default': 'tool',
                                                                                                                 'schema': {'expected': ['tool'],
                                                                                                                            'type': 'literal'},
                                                                                                                 'type': 'default'},
                                                                                                      'type': 'model-field'}},
                                                                                  'model_name': 'ToolMessage',
                                                                                  'type': 'model-fields'},
                                                                       'type': 'function-before'},
                                                            'type': 'model'},
 'langchain_core.messages.tool.ToolMessageChunk:1597346545424': {'cls': &lt;class 'langchain_core.messages.tool.ToolMessageChunk'&gt;,
                                                                 'config': {'extra_fields_behavior': 'allow',
                                                                            'title': 'ToolMessageChunk'},
                                                                 'custom_init': True,
                                                                 'metadata': {'pydantic_js_functions': [&lt;bound method BaseModel.__get_pydantic_json_schema__ of &lt;class 'langchain_core.messages.tool.ToolMessageChunk'&gt;&gt;]},
                                                                 'ref': 'langchain_core.messages.tool.ToolMessageChunk:1597346545424',
                                                                 'root_model': False,
                                                                 'schema': {'function': {'function': &lt;bound method ToolMessage.coerce_args of &lt;class 'langchain_core.messages.tool.ToolMessageChunk'&gt;&gt;,
                                                                                         'type': 'no-info'},
                                                                            'schema': {'computed_fields': [],
                                                                                       'fields': {'additional_kwargs': {'metadata': {},
                                                                                                                        'schema': {'default_factory': &lt;class 'dict'&gt;,
                                                                                                                                   'default_factory_takes_data': False,
                                                                                                                                   'schema': {'keys_schema': {'type': 'any'},
                                                                                                                                              'type': 'dict',
                                                                                                                                              'values_schema': {'type': 'any'}},
                                                                                                                                   'type': 'default'},
                                                                                                                        'type': 'model-field'},
                                                                                                  'artifact': {'metadata': {},
                                                                                                               'schema': {'default': None,
                                                                                                                          'schema': {'type': 'any'},
                                                                                                                          'type': 'default'},
                                                                                                               'type': 'model-field'},
                                                                                                  'content': {'metadata': {},
                                                                                                              'schema': {'choices': [{'type': 'str'},
                                                                                                                                     {'items_schema': {'choices': [{'type': 'str'},
                                                                                                                                                                   {'keys_schema': {'type': 'any'},
                                                                                                                                                                    'type': 'dict',
                                                                                                                                                                    'values_schema': {'type': 'any'}}],
                                                                                                                                                       'type': 'union'},
                                                                                                                                      'type': 'list'}],
                                                                                                                         'type': 'union'},
                                                                                                              'type': 'model-field'},
                                                                                                  'id': {'metadata': {},
                                                                                                         'schema': {'default': None,
                                                                                                                    'schema': {'schema': {'coerce_numbers_to_str': True,
                                                                                                                                          'type': 'str'},
                                                                                                                               'type': 'nullable'},
                                                                                                                    'type': 'default'},
                                                                                                         'type': 'model-field'},
                                                                                                  'name': {'metadata': {},
                                                                                                           'schema': {'default': None,
                                                                                                                      'schema': {'schema': {'type': 'str'},
                                                                                                                                 'type': 'nullable'},
                                                                                                                      'type': 'default'},
                                                                                                           'type': 'model-field'},
                                                                                                  'response_metadata': {'metadata': {},
                                                                                                                        'schema': {'default_factory': &lt;class 'dict'&gt;,
                                                                                                                                   'default_factory_takes_data': False,
                                                                                                                                   'schema': {'keys_schema': {'type': 'any'},
                                                                                                                                              'type': 'dict',
                                                                                                                                              'values_schema': {'type': 'any'}},
                                                                                                                                   'type': 'default'},
                                                                                                                        'type': 'model-field'},
                                                                                                  'status': {'metadata': {},
                                                                                                             'schema': {'default': 'success',
                                                                                                                        'schema': {'expected': ['success',
                                                                                                                                                'error'],
                                                                                                                                   'type': 'literal'},
                                                                                                                        'type': 'default'},
                                                                                                             'type': 'model-field'},
                                                                                                  'tool_call_id': {'metadata': {},
                                                                                                                   'schema': {'type': 'str'},
                                                                                                                   'type': 'model-field'},
                                                                                                  'type': {'metadata': {},
                                                                                                           'schema': {'default': 'ToolMessageChunk',
                                                                                                                      'schema': {'expected': ['ToolMessageChunk'],
                                                                                                                                 'type': 'literal'},
                                                                                                                      'type': 'default'},
                                                                                                           'type': 'model-field'}},
                                                                                       'model_name': 'ToolMessageChunk',
                                                                                       'type': 'model-fields'},
                                                                            'type': 'function-before'},
                                                                 'type': 'model'}}
        discriminator = Discriminator(discriminator=&lt;function _get_type at 0x00000173EADB7D80&gt;,
              custom_error_type=None,
              custom_error_message=None,
              custom_error_context=None)
        schema     = {'choices': [({'metadata': {'pydantic_internal_union_tag_key': 'ai'},
               'schema_ref': 'langchain_core.messages.ai.AIMessage:1597346559312',
               'type': 'definition-ref'},
              'ai'),
             ({'metadata': {'pydantic_internal_union_tag_key': 'human'},
               'schema_ref': 'langchain_core.messages.human.HumanMessage:1597346558320',
               'type': 'definition-ref'},
              'human'),
             ({'metadata': {'pydantic_internal_union_tag_key': 'chat'},
               'schema_ref': 'langchain_core.messages.chat.ChatMessage:1597346573200',
               'type': 'definition-ref'},
              'chat'),
             ({'metadata': {'pydantic_internal_union_tag_key': 'system'},
               'schema_ref': 'langchain_core.messages.system.SystemMessage:1597346577168',
               'type': 'definition-ref'},
              'system'),
             ({'metadata': {'pydantic_internal_union_tag_key': 'function'},
               'schema_ref': 'langchain_core.messages.function.FunctionMessage:1597346554352',
               'type': 'definition-ref'},
              'function'),
             ({'metadata': {'pydantic_internal_union_tag_key': 'tool'},
               'schema_ref': 'langchain_core.messages.tool.ToolMessage:1597346539472',
               'type': 'definition-ref'},
              'tool'),
             ({'metadata': {'pydantic_internal_union_tag_key': 'AIMessageChunk'},
               'schema_ref': 'langchain_core.messages.ai.AIMessageChunk:1597346566256',
               'type': 'definition-ref'},
              'AIMessageChunk'),
             ({'metadata': {'pydantic_internal_union_tag_key': 'HumanMessageChunk'},
               'schema_ref': 'langchain_core.messages.human.HumanMessageChunk:1597346553360',
               'type': 'definition-ref'},
              'HumanMessageChunk'),
             ({'metadata': {'pydantic_internal_union_tag_key': 'ChatMessageChunk'},
               'schema_ref': 'langchain_core.messages.chat.ChatMessageChunk:1597346576176',
               'type': 'definition-ref'},
              'ChatMessageChunk'),
             ({'metadata': {'pydantic_internal_union_tag_key': 'SystemMessageChunk'},
               'schema_ref': 'langchain_core.messages.system.SystemMessageChunk:1597346584112',
               'type': 'definition-ref'},
              'SystemMessageChunk'),
             ({'metadata': {'pydantic_internal_union_tag_key': 'FunctionMessageChunk'},
               'schema_ref': 'langchain_core.messages.function.FunctionMessageChunk:1597346564272',
               'type': 'definition-ref'},
              'FunctionMessageChunk'),
             ({'metadata': {'pydantic_internal_union_tag_key': 'ToolMessageChunk'},
               'schema_ref': 'langchain_core.messages.tool.ToolMessageChunk:1597346545424',
               'type': 'definition-ref'},
              'ToolMessageChunk')],
 'type': 'union'}
..\..\AppData\Local\Programs\Python\Python313\Lib\site-packages\pydantic\_internal\_discriminated_union.py:164: in apply
    schema = self._apply_to_root(schema)
             ^^^^^^^^^^^^^^^^^^^^^^^^^^^
        schema     = {'choices': [({'metadata': {'pydantic_internal_union_tag_key': 'ai'},
               'schema_ref': 'langchain_core.messages.ai.AIMessage:1597346559312',
               'type': 'definition-ref'},
              'ai'),
             ({'metadata': {'pydantic_internal_union_tag_key': 'human'},
               'schema_ref': 'langchain_core.messages.human.HumanMessage:1597346558320',
               'type': 'definition-ref'},
              'human'),
             ({'metadata': {'pydantic_internal_union_tag_key': 'chat'},
               'schema_ref': 'langchain_core.messages.chat.ChatMessage:1597346573200',
               'type': 'definition-ref'},
              'chat'),
             ({'metadata': {'pydantic_internal_union_tag_key': 'system'},
               'schema_ref': 'langchain_core.messages.system.SystemMessage:1597346577168',
               'type': 'definition-ref'},
              'system'),
             ({'metadata': {'pydantic_internal_union_tag_key': 'function'},
               'schema_ref': 'langchain_core.messages.function.FunctionMessage:1597346554352',
               'type': 'definition-ref'},
              'function'),
             ({'metadata': {'pydantic_internal_union_tag_key': 'tool'},
               'schema_ref': 'langchain_core.messages.tool.ToolMessage:1597346539472',
               'type': 'definition-ref'},
              'tool'),
             ({'metadata': {'pydantic_internal_union_tag_key': 'AIMessageChunk'},
               'schema_ref': 'langchain_core.messages.ai.AIMessageChunk:1597346566256',
               'type': 'definition-ref'},
              'AIMessageChunk'),
             ({'metadata': {'pydantic_internal_union_tag_key': 'HumanMessageChunk'},
               'schema_ref': 'langchain_core.messages.human.HumanMessageChunk:1597346553360',
               'type': 'definition-ref'},
              'HumanMessageChunk'),
             ({'metadata': {'pydantic_internal_union_tag_key': 'ChatMessageChunk'},
               'schema_ref': 'langchain_core.messages.chat.ChatMessageChunk:1597346576176',
               'type': 'definition-ref'},
              'ChatMessageChunk'),
             ({'metadata': {'pydantic_internal_union_tag_key': 'SystemMessageChunk'},
               'schema_ref': 'langchain_core.messages.system.SystemMessageChunk:1597346584112',
               'type': 'definition-ref'},
              'SystemMessageChunk'),
             ({'metadata': {'pydantic_internal_union_tag_key': 'FunctionMessageChunk'},
               'schema_ref': 'langchain_core.messages.function.FunctionMessageChunk:1597346564272',
               'type': 'definition-ref'},
              'FunctionMessageChunk'),
             ({'metadata': {'pydantic_internal_union_tag_key': 'ToolMessageChunk'},
               'schema_ref': 'langchain_core.messages.tool.ToolMessageChunk:1597346545424',
               'type': 'definition-ref'},
              'ToolMessageChunk')],
 'type': 'union'}
        self       = &lt;pydantic._internal._discriminated_union._ApplyInferredDiscriminator object at 0x00000173EA583D90&gt;
..\..\AppData\Local\Programs\Python\Python313\Lib\site-packages\pydantic\_internal\_discriminated_union.py:200: in _apply_to_root
    self._handle_choice(choice)
        choice     = {'metadata': {'pydantic_internal_union_tag_key': 'ai'},
 'schema_ref': 'langchain_core.messages.ai.AIMessage:1597346559312',
 'type': 'definition-ref'}
        choices_schemas = [{'metadata': {'pydantic_internal_union_tag_key': 'ToolMessageChunk'},
  'schema_ref': 'langchain_core.messages.tool.ToolMessageChunk:1597346545424',
  'type': 'definition-ref'},
 {'metadata': {'pydantic_internal_union_tag_key': 'FunctionMessageChunk'},
  'schema_ref': 'langchain_core.messages.function.FunctionMessageChunk:1597346564272',
  'type': 'definition-ref'},
 {'metadata': {'pydantic_internal_union_tag_key': 'SystemMessageChunk'},
  'schema_ref': 'langchain_core.messages.system.SystemMessageChunk:1597346584112',
  'type': 'definition-ref'},
 {'metadata': {'pydantic_internal_union_tag_key': 'ChatMessageChunk'},
  'schema_ref': 'langchain_core.messages.chat.ChatMessageChunk:1597346576176',
  'type': 'definition-ref'},
 {'metadata': {'pydantic_internal_union_tag_key': 'HumanMessageChunk'},
  'schema_ref': 'langchain_core.messages.human.HumanMessageChunk:1597346553360',
  'type': 'definition-ref'},
 {'metadata': {'pydantic_internal_union_tag_key': 'AIMessageChunk'},
  'schema_ref': 'langchain_core.messages.ai.AIMessageChunk:1597346566256',
  'type': 'definition-ref'},
 {'metadata': {'pydantic_internal_union_tag_key': 'tool'},
  'schema_ref': 'langchain_core.messages.tool.ToolMessage:1597346539472',
  'type': 'definition-ref'},
 {'metadata': {'pydantic_internal_union_tag_key': 'function'},
  'schema_ref': 'langchain_core.messages.function.FunctionMessage:1597346554352',
  'type': 'definition-ref'},
 {'metadata': {'pydantic_internal_union_tag_key': 'system'},
  'schema_ref': 'langchain_core.messages.system.SystemMessage:1597346577168',
  'type': 'definition-ref'},
 {'metadata': {'pydantic_internal_union_tag_key': 'chat'},
  'schema_ref': 'langchain_core.messages.chat.ChatMessage:1597346573200',
  'type': 'definition-ref'},
 {'metadata': {'pydantic_internal_union_tag_key': 'human'},
  'schema_ref': 'langchain_core.messages.human.HumanMessage:1597346558320',
  'type': 'definition-ref'},
 {'metadata': {'pydantic_internal_union_tag_key': 'ai'},
  'schema_ref': 'langchain_core.messages.ai.AIMessage:1597346559312',
  'type': 'definition-ref'}]
        schema     = {'choices': [({'metadata': {'pydantic_internal_union_tag_key': 'ai'},
               'schema_ref': 'langchain_core.messages.ai.AIMessage:1597346559312',
               'type': 'definition-ref'},
              'ai'),
             ({'metadata': {'pydantic_internal_union_tag_key': 'human'},
               'schema_ref': 'langchain_core.messages.human.HumanMessage:1597346558320',
               'type': 'definition-ref'},
              'human'),
             ({'metadata': {'pydantic_internal_union_tag_key': 'chat'},
               'schema_ref': 'langchain_core.messages.chat.ChatMessage:1597346573200',
               'type': 'definition-ref'},
              'chat'),
             ({'metadata': {'pydantic_internal_union_tag_key': 'system'},
               'schema_ref': 'langchain_core.messages.system.SystemMessage:1597346577168',
               'type': 'definition-ref'},
              'system'),
             ({'metadata': {'pydantic_internal_union_tag_key': 'function'},
               'schema_ref': 'langchain_core.messages.function.FunctionMessage:1597346554352',
               'type': 'definition-ref'},
              'function'),
             ({'metadata': {'pydantic_internal_union_tag_key': 'tool'},
               'schema_ref': 'langchain_core.messages.tool.ToolMessage:1597346539472',
               'type': 'definition-ref'},
              'tool'),
             ({'metadata': {'pydantic_internal_union_tag_key': 'AIMessageChunk'},
               'schema_ref': 'langchain_core.messages.ai.AIMessageChunk:1597346566256',
               'type': 'definition-ref'},
              'AIMessageChunk'),
             ({'metadata': {'pydantic_internal_union_tag_key': 'HumanMessageChunk'},
               'schema_ref': 'langchain_core.messages.human.HumanMessageChunk:1597346553360',
               'type': 'definition-ref'},
              'HumanMessageChunk'),
             ({'metadata': {'pydantic_internal_union_tag_key': 'ChatMessageChunk'},
               'schema_ref': 'langchain_core.messages.chat.ChatMessageChunk:1597346576176',
               'type': 'definition-ref'},
              'ChatMessageChunk'),
             ({'metadata': {'pydantic_internal_union_tag_key': 'SystemMessageChunk'},
               'schema_ref': 'langchain_core.messages.system.SystemMessageChunk:1597346584112',
               'type': 'definition-ref'},
              'SystemMessageChunk'),
             ({'metadata': {'pydantic_internal_union_tag_key': 'FunctionMessageChunk'},
               'schema_ref': 'langchain_core.messages.function.FunctionMessageChunk:1597346564272',
               'type': 'definition-ref'},
              'FunctionMessageChunk'),
             ({'metadata': {'pydantic_internal_union_tag_key': 'ToolMessageChunk'},
               'schema_ref': 'langchain_core.messages.tool.ToolMessageChunk:1597346545424',
               'type': 'definition-ref'},
              'ToolMessageChunk')],
 'type': 'union'}
        self       = &lt;pydantic._internal._discriminated_union._ApplyInferredDiscriminator object at 0x00000173EA583D90&gt;
..\..\AppData\Local\Programs\Python\Python313\Lib\site-packages\pydantic\_internal\_discriminated_union.py:278: in _handle_choice
    inferred_discriminator_values = self._infer_discriminator_values_for_choice(choice, source_name=None)
                                    ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
        choice     = {'metadata': {'pydantic_internal_union_tag_key': 'ai'},
 'schema_ref': 'langchain_core.messages.ai.AIMessage:1597346559312',
 'type': 'definition-ref'}
        self       = &lt;pydantic._internal._discriminated_union._ApplyInferredDiscriminator object at 0x00000173EA583D90&gt;
..\..\AppData\Local\Programs\Python\Python313\Lib\site-packages\pydantic\_internal\_discriminated_union.py:354: in _infer_discriminator_values_for_choice
    return self._infer_discriminator_values_for_choice(self.definitions[schema_ref], source_name=source_name)
           ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
        choice     = {'metadata': {'pydantic_internal_union_tag_key': 'ai'},
 'schema_ref': 'langchain_core.messages.ai.AIMessage:1597346559312',
 'type': 'definition-ref'}
        schema_ref = 'langchain_core.messages.ai.AIMessage:1597346559312'
        self       = &lt;pydantic._internal._discriminated_union._ApplyInferredDiscriminator object at 0x00000173EA583D90&gt;
        source_name = None
..\..\AppData\Local\Programs\Python\Python313\Lib\site-packages\pydantic\_internal\_discriminated_union.py:336: in _infer_discriminator_values_for_choice
    return self._infer_discriminator_values_for_choice(choice['schema'], source_name=choice['cls'].__name__)
           ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
        choice     = {'cls': &lt;class 'langchain_core.messages.ai.AIMessage'&gt;,
 'config': {'extra_fields_behavior': 'allow', 'title': 'AIMessage'},
 'custom_init': True,
 'metadata': {'pydantic_js_functions': [&lt;bound method BaseModel.__get_pydantic_json_schema__ of &lt;class 'langchain_core.messages.ai.AIMessage'&gt;&gt;]},
 'ref': 'langchain_core.messages.ai.AIMessage:1597346559312',
 'root_model': False,
 'schema': {'function': {'function': &lt;bound method AIMessage._backwards_compat_tool_calls of &lt;class 'langchain_core.messages.ai.AIMessage'&gt;&gt;,
                         'type': 'no-info'},
            'schema': {'computed_fields': [],
                       'fields': {'additional_kwargs': {'metadata': {},
                                                        'schema': {'default_factory': &lt;class 'dict'&gt;,
                                                                   'default_factory_takes_data': False,
                                                                   'schema': {'keys_schema': {'type': 'any'},
                                                                              'type': 'dict',
                                                                              'values_schema': {'type': 'any'}},
                                                                   'type': 'default'},
                                                        'type': 'model-field'},
                                  'content': {'metadata': {},
                                              'schema': {'choices': [{'type': 'str'},
                                                                     {'items_schema': {'choices': [{'type': 'str'},
                                                                                                   {'keys_schema': {'type': 'any'},
                                                                                                    'type': 'dict',
                                                                                                    'values_schema': {'type': 'any'}}],
                                                                                       'type': 'union'},
                                                                      'type': 'list'}],
                                                         'type': 'union'},
                                              'type': 'model-field'},
                                  'id': {'metadata': {},
                                         'schema': {'default': None,
                                                    'schema': {'schema': {'coerce_numbers_to_str': True,
                                                                          'type': 'str'},
                                                               'type': 'nullable'},
                                                    'type': 'default'},
                                         'type': 'model-field'},
                                  'invalid_tool_calls': {'metadata': {},
                                                         'schema': {'default': [],
                                                                    'schema': {'items_schema': {'cls': &lt;class 'langchain_core.messages.content.InvalidToolCall'&gt;,
                                                                                                'computed_fields': [],
                                                                                                'config': {'extra_fields_behavior': 'allow',
                                                                                                           'title': 'InvalidToolCall'},
                                                                                                'extra_behavior': 'allow',
                                                                                                'fields': {'args': {'metadata': {},
                                                                                                                    'required': True,
                                                                                                                    'schema': {'schema': {'type': 'str'},
                                                                                                                               'type': 'nullable'},
                                                                                                                    'type': 'typed-dict-field'},
                                                                                                           'error': {'metadata': {},
                                                                                                                     'required': True,
                                                                                                                     'schema': {'schema': {'type': 'str'},
                                                                                                                                'type': 'nullable'},
                                                                                                                     'type': 'typed-dict-field'},
                                                                                                           'extras': {'metadata': {},
                                                                                                                      'required': False,
                                                                                                                      'schema': {'keys_schema': {'type': 'str'},
                                                                                                                                 'type': 'dict',
                                                                                                                                 'values_schema': {'type': 'any'}},
                                                                                                                      'type': 'typed-dict-field'},
                                                                                                           'id': {'metadata': {},
                                                                                                                  'required': True,
                                                                                                                  'schema': {'schema': {'type': 'str'},
                                                                                                                             'type': 'nullable'},
                                                                                                                  'type': 'typed-dict-field'},
                                                                                                           'index': {'metadata': {},
                                                                                                                     'required': False,
                                                                                                                     'schema': {'choices': [{'type': 'int'},
                                                                                                                                            {'type': 'str'}],
                                                                                                                                'type': 'union'},
                                                                                                                     'type': 'typed-dict-field'},
                                                                                                           'name': {'metadata': {},
                                                                                                                    'required': True,
                                                                                                                    'schema': {'schema': {'type': 'str'},
                                                                                                                               'type': 'nullable'},
                                                                                                                    'type': 'typed-dict-field'},
                                                                                                           'type': {'metadata': {},
                                                                                                                    'required': True,
                                                                                                                    'schema': {'expected': ['invalid_tool_call'],
                                                                                                                               'type': 'literal'},
                                                                                                                    'type': 'typed-dict-field'}},
                                                                                                'ref': 'langchain_core.messages.content.InvalidToolCall:1597346642640',
                                                                                                'type': 'typed-dict'},
                                                                               'type': 'list'},
                                                                    'type': 'default'},
                                                         'type': 'model-field'},
                                  'name': {'metadata': {},
                                           'schema': {'default': None,
                                                      'schema': {'schema': {'type': 'str'},
                                                                 'type': 'nullable'},
                                                      'type': 'default'},
                                           'type': 'model-field'},
                                  'response_metadata': {'metadata': {},
                                                        'schema': {'default_factory': &lt;class 'dict'&gt;,
                                                                   'default_factory_takes_data': False,
                                                                   'schema': {'keys_schema': {'type': 'any'},
                                                                              'type': 'dict',
                                                                              'values_schema': {'type': 'any'}},
                                                                   'type': 'default'},
                                                        'type': 'model-field'},
                                  'tool_calls': {'metadata': {},
                                                 'schema': {'default': [],
                                                            'schema': {'items_schema': {'cls': &lt;class 'langchain_core.messages.tool.ToolCall'&gt;,
                                                                                        'computed_fields': [],
                                                                                        'config': {'extra_fields_behavior': 'allow',
                                                                                                   'title': 'ToolCall'},
                                                                                        'extra_behavior': 'allow',
                                                                                        'fields': {'args': {'metadata': {},
                                                                                                            'required': True,
                                                                                                            'schema': {'keys_schema': {'type': 'str'},
                                                                                                                       'type': 'dict',
                                                                                                                       'values_schema': {'type': 'any'}},
                                                                                                            'type': 'typed-dict-field'},
                                                                                                   'id': {'metadata': {},
                                                                                                          'required': True,
                                                                                                          'schema': {'schema': {'type': 'str'},
                                                                                                                     'type': 'nullable'},
                                                                                                          'type': 'typed-dict-field'},
                                                                                                   'name': {'metadata': {},
                                                                                                            'required': True,
                                                                                                            'schema': {'type': 'str'},
                                                                                                            'type': 'typed-dict-field'},
                                                                                                   'type': {'metadata': {},
                                                                                                            'required': False,
                                                                                                            'schema': {'expected': ['tool_call'],
                                                                                                                       'type': 'literal'},
                                                                                                            'type': 'typed-dict-field'}},
                                                                                        'ref': 'langchain_core.messages.tool.ToolCall:1597346538480',
                                                                                        'type': 'typed-dict'},
                                                                       'type': 'list'},
                                                            'type': 'default'},
                                                 'type': 'model-field'},
                                  'type': {'metadata': {},
                                           'schema': {'default': 'ai',
                                                      'schema': {'expected': ['ai'],
                                                                 'type': 'literal'},
                                                      'type': 'default'},
                                           'type': 'model-field'},
                                  'usage_metadata': {'metadata': {},
                                                     'schema': {'default': None,
                                                                'schema': {'schema': {'cls': &lt;class 'langchain_core.messages.ai.UsageMetadata'&gt;,
                                                                                      'computed_fields': [],
                                                                                      'config': {'extra_fields_behavior': 'allow',
                                                                                                 'title': 'UsageMetadata'},
                                                                                      'extra_behavior': 'allow',
                                                                                      'fields': {'input_token_details': {'metadata': {},
                                                                                                                         'required': False,
                                                                                                                         'schema': {'cls': &lt;class 'langchain_core.messages.ai.InputTokenDetails'&gt;,
                                                                                                                                    'computed_fields': [],
                                                                                                                                    'config': {'extra_fields_behavior': 'allow',
                                                                                                                                               'title': 'InputTokenDetails'},
                                                                                                                                    'extra_behavior': 'allow',
                                                                                                                                    'fields': {'audio': {'metadata': {},
                                                                                                                                                         'required': False,
                                                                                                                                                         'schema': {'type': 'int'},
                                                                                                                                                         'type': 'typed-dict-field'},
                                                                                                                                               'cache_creation': {'metadata': {},
                                                                                                                                                                  'required': False,
                                                                                                                                                                  'schema': {'type': 'int'},
                                                                                                                                                                  'type': 'typed-dict-field'},
                                                                                                                                               'cache_read': {'metadata': {},
                                                                                                                                                              'required': False,
                                                                                                                                                              'schema': {'type': 'int'},
                                                                                                                                                              'type': 'typed-dict-field'}},
                                                                                                                                    'ref': 'langchain_core.messages.ai.InputTokenDetails:1597346536496',
                                                                                                                                    'type': 'typed-dict'},
                                                                                                                         'type': 'typed-dict-field'},
                                                                                                 'input_tokens': {'metadata': {},
                                                                                                                  'required': True,
                                                                                                                  'schema': {'type': 'int'},
                                                                                                                  'type': 'typed-dict-field'},
                                                                                                 'output_token_details': {'metadata': {},
                                                                                                                          'required': False,
                                                                                                                          'schema': {'cls': &lt;class 'langchain_core.messages.ai.OutputTokenDetails'&gt;,
                                                                                                                                     'computed_fields': [],
                                                                                                                                     'config': {'extra_fields_behavior': 'allow',
                                                                                                                                                'title': 'OutputTokenDetails'},
                                                                                                                                     'extra_behavior': 'allow',
                                                                                                                                     'fields': {'audio': {'metadata': {},
                                                                                                                                                          'required': False,
                                                                                                                                                          'schema': {'type': 'int'},
                                                                                                                                                          'type': 'typed-dict-field'},
                                                                                                                                                'reasoning': {'metadata': {},
                                                                                                                                                              'required': False,
                                                                                                                                                              'schema': {'type': 'int'},
                                                                                                                                                              'type': 'typed-dict-field'}},
                                                                                                                                     'ref': 'langchain_core.messages.ai.OutputTokenDetails:1597346561296',
                                                                                                                                     'type': 'typed-dict'},
                                                                                                                          'type': 'typed-dict-field'},
                                                                                                 'output_tokens': {'metadata': {},
                                                                                                                   'required': True,
                                                                                                                   'schema': {'type': 'int'},
                                                                                                                   'type': 'typed-dict-field'},
                                                                                                 'total_tokens': {'metadata': {},
                                                                                                                  'required': True,
                                                                                                                  'schema': {'type': 'int'},
                                                                                                                  'type': 'typed-dict-field'}},
                                                                                      'ref': 'langchain_core.messages.ai.UsageMetadata:1597346557328',
                                                                                      'type': 'typed-dict'},
                                                                           'type': 'nullable'},
                                                                'type': 'default'},
                                                     'type': 'model-field'}},
                       'model_name': 'AIMessage',
                       'type': 'model-fields'},
            'type': 'function-before'},
 'type': 'model'}
        self       = &lt;pydantic._internal._discriminated_union._ApplyInferredDiscriminator object at 0x00000173EA583D90&gt;
        source_name = None
..\..\AppData\Local\Programs\Python\Python313\Lib\site-packages\pydantic\_internal\_discriminated_union.py:304: in _infer_discriminator_values_for_choice
    return self._infer_discriminator_values_for_choice(choice['schema'], source_name=source_name)
           ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
        choice     = {'function': {'function': &lt;bound method AIMessage._backwards_compat_tool_calls of &lt;class 'langchain_core.messages.ai.AIMessage'&gt;&gt;,
              'type': 'no-info'},
 'schema': {'computed_fields': [],
            'fields': {'additional_kwargs': {'metadata': {},
                                             'schema': {'default_factory': &lt;class 'dict'&gt;,
                                                        'default_factory_takes_data': False,
                                                        'schema': {'keys_schema': {'type': 'any'},
                                                                   'type': 'dict',
                                                                   'values_schema': {'type': 'any'}},
                                                        'type': 'default'},
                                             'type': 'model-field'},
                       'content': {'metadata': {},
                                   'schema': {'choices': [{'type': 'str'},
                                                          {'items_schema': {'choices': [{'type': 'str'},
                                                                                        {'keys_schema': {'type': 'any'},
                                                                                         'type': 'dict',
                                                                                         'values_schema': {'type': 'any'}}],
                                                                            'type': 'union'},
                                                           'type': 'list'}],
                                              'type': 'union'},
                                   'type': 'model-field'},
                       'id': {'metadata': {},
                              'schema': {'default': None,
                                         'schema': {'schema': {'coerce_numbers_to_str': True,
                                                               'type': 'str'},
                                                    'type': 'nullable'},
                                         'type': 'default'},
                              'type': 'model-field'},
                       'invalid_tool_calls': {'metadata': {},
                                              'schema': {'default': [],
                                                         'schema': {'items_schema': {'cls': &lt;class 'langchain_core.messages.content.InvalidToolCall'&gt;,
                                                                                     'computed_fields': [],
                                                                                     'config': {'extra_fields_behavior': 'allow',
                                                                                                'title': 'InvalidToolCall'},
                                                                                     'extra_behavior': 'allow',
                                                                                     'fields': {'args': {'metadata': {},
                                                                                                         'required': True,
                                                                                                         'schema': {'schema': {'type': 'str'},
                                                                                                                    'type': 'nullable'},
                                                                                                         'type': 'typed-dict-field'},
                                                                                                'error': {'metadata': {},
                                                                                                          'required': True,
                                                                                                          'schema': {'schema': {'type': 'str'},
                                                                                                                     'type': 'nullable'},
                                                                                                          'type': 'typed-dict-field'},
                                                                                                'extras': {'metadata': {},
                                                                                                           'required': False,
                                                                                                           'schema': {'keys_schema': {'type': 'str'},
                                                                                                                      'type': 'dict',
                                                                                                                      'values_schema': {'type': 'any'}},
                                                                                                           'type': 'typed-dict-field'},
                                                                                                'id': {'metadata': {},
                                                                                                       'required': True,
                                                                                                       'schema': {'schema': {'type': 'str'},
                                                                                                                  'type': 'nullable'},
                                                                                                       'type': 'typed-dict-field'},
                                                                                                'index': {'metadata': {},
                                                                                                          'required': False,
                                                                                                          'schema': {'choices': [{'type': 'int'},
                                                                                                                                 {'type': 'str'}],
                                                                                                                     'type': 'union'},
                                                                                                          'type': 'typed-dict-field'},
                                                                                                'name': {'metadata': {},
                                                                                                         'required': True,
                                                                                                         'schema': {'schema': {'type': 'str'},
                                                                                                                    'type': 'nullable'},
                                                                                                         'type': 'typed-dict-field'},
                                                                                                'type': {'metadata': {},
                                                                                                         'required': True,
                                                                                                         'schema': {'expected': ['invalid_tool_call'],
                                                                                                                    'type': 'literal'},
                                                                                                         'type': 'typed-dict-field'}},
                                                                                     'ref': 'langchain_core.messages.content.InvalidToolCall:1597346642640',
                                                                                     'type': 'typed-dict'},
                                                                    'type': 'list'},
                                                         'type': 'default'},
                                              'type': 'model-field'},
                       'name': {'metadata': {},
                                'schema': {'default': None,
                                           'schema': {'schema': {'type': 'str'},
                                                      'type': 'nullable'},
                                           'type': 'default'},
                                'type': 'model-field'},
                       'response_metadata': {'metadata': {},
                                             'schema': {'default_factory': &lt;class 'dict'&gt;,
                                                        'default_factory_takes_data': False,
                                                        'schema': {'keys_schema': {'type': 'any'},
                                                                   'type': 'dict',
                                                                   'values_schema': {'type': 'any'}},
                                                        'type': 'default'},
                                             'type': 'model-field'},
                       'tool_calls': {'metadata': {},
                                      'schema': {'default': [],
                                                 'schema': {'items_schema': {'cls': &lt;class 'langchain_core.messages.tool.ToolCall'&gt;,
                                                                             'computed_fields': [],
                                                                             'config': {'extra_fields_behavior': 'allow',
                                                                                        'title': 'ToolCall'},
                                                                             'extra_behavior': 'allow',
                                                                             'fields': {'args': {'metadata': {},
                                                                                                 'required': True,
                                                                                                 'schema': {'keys_schema': {'type': 'str'},
                                                                                                            'type': 'dict',
                                                                                                            'values_schema': {'type': 'any'}},
                                                                                                 'type': 'typed-dict-field'},
                                                                                        'id': {'metadata': {},
                                                                                               'required': True,
                                                                                               'schema': {'schema': {'type': 'str'},
                                                                                                          'type': 'nullable'},
                                                                                               'type': 'typed-dict-field'},
                                                                                        'name': {'metadata': {},
                                                                                                 'required': True,
                                                                                                 'schema': {'type': 'str'},
                                                                                                 'type': 'typed-dict-field'},
                                                                                        'type': {'metadata': {},
                                                                                                 'required': False,
                                                                                                 'schema': {'expected': ['tool_call'],
                                                                                                            'type': 'literal'},
                                                                                                 'type': 'typed-dict-field'}},
                                                                             'ref': 'langchain_core.messages.tool.ToolCall:1597346538480',
                                                                             'type': 'typed-dict'},
                                                            'type': 'list'},
                                                 'type': 'default'},
                                      'type': 'model-field'},
                       'type': {'metadata': {},
                                'schema': {'default': 'ai',
                                           'schema': {'expected': ['ai'],
                                                      'type': 'literal'},
                                           'type': 'default'},
                                'type': 'model-field'},
                       'usage_metadata': {'metadata': {},
                                          'schema': {'default': None,
                                                     'schema': {'schema': {'cls': &lt;class 'langchain_core.messages.ai.UsageMetadata'&gt;,
                                                                           'computed_fields': [],
                                                                           'config': {'extra_fields_behavior': 'allow',
                                                                                      'title': 'UsageMetadata'},
                                                                           'extra_behavior': 'allow',
                                                                           'fields': {'input_token_details': {'metadata': {},
                                                                                                              'required': False,
                                                                                                              'schema': {'cls': &lt;class 'langchain_core.messages.ai.InputTokenDetails'&gt;,
                                                                                                                         'computed_fields': [],
                                                                                                                         'config': {'extra_fields_behavior': 'allow',
                                                                                                                                    'title': 'InputTokenDetails'},
                                                                                                                         'extra_behavior': 'allow',
                                                                                                                         'fields': {'audio': {'metadata': {},
                                                                                                                                              'required': False,
                                                                                                                                              'schema': {'type': 'int'},
                                                                                                                                              'type': 'typed-dict-field'},
                                                                                                                                    'cache_creation': {'metadata': {},
                                                                                                                                                       'required': False,
                                                                                                                                                       'schema': {'type': 'int'},
                                                                                                                                                       'type': 'typed-dict-field'},
                                                                                                                                    'cache_read': {'metadata': {},
                                                                                                                                                   'required': False,
                                                                                                                                                   'schema': {'type': 'int'},
                                                                                                                                                   'type': 'typed-dict-field'}},
                                                                                                                         'ref': 'langchain_core.messages.ai.InputTokenDetails:1597346536496',
                                                                                                                         'type': 'typed-dict'},
                                                                                                              'type': 'typed-dict-field'},
                                                                                      'input_tokens': {'metadata': {},
                                                                                                       'required': True,
                                                                                                       'schema': {'type': 'int'},
                                                                                                       'type': 'typed-dict-field'},
                                                                                      'output_token_details': {'metadata': {},
                                                                                                               'required': False,
                                                                                                               'schema': {'cls': &lt;class 'langchain_core.messages.ai.OutputTokenDetails'&gt;,
                                                                                                                          'computed_fields': [],
                                                                                                                          'config': {'extra_fields_behavior': 'allow',
                                                                                                                                     'title': 'OutputTokenDetails'},
                                                                                                                          'extra_behavior': 'allow',
                                                                                                                          'fields': {'audio': {'metadata': {},
                                                                                                                                               'required': False,
                                                                                                                                               'schema': {'type': 'int'},
                                                                                                                                               'type': 'typed-dict-field'},
                                                                                                                                     'reasoning': {'metadata': {},
                                                                                                                                                   'required': False,
                                                                                                                                                   'schema': {'type': 'int'},
                                                                                                                                                   'type': 'typed-dict-field'}},
                                                                                                                          'ref': 'langchain_core.messages.ai.OutputTokenDetails:1597346561296',
                                                                                                                          'type': 'typed-dict'},
                                                                                                               'type': 'typed-dict-field'},
                                                                                      'output_tokens': {'metadata': {},
                                                                                                        'required': True,
                                                                                                        'schema': {'type': 'int'},
                                                                                                        'type': 'typed-dict-field'},
                                                                                      'total_tokens': {'metadata': {},
                                                                                                       'required': True,
                                                                                                       'schema': {'type': 'int'},
                                                                                                       'type': 'typed-dict-field'}},
                                                                           'ref': 'langchain_core.messages.ai.UsageMetadata:1597346557328',
                                                                           'type': 'typed-dict'},
                                                                'type': 'nullable'},
                                                     'type': 'default'},
                                          'type': 'model-field'}},
            'model_name': 'AIMessage',
            'type': 'model-fields'},
 'type': 'function-before'}
        self       = &lt;pydantic._internal._discriminated_union._ApplyInferredDiscriminator object at 0x00000173EA583D90&gt;
        source_name = 'AIMessage'
..\..\AppData\Local\Programs\Python\Python313\Lib\site-packages\pydantic\_internal\_discriminated_union.py:342: in _infer_discriminator_values_for_choice
    return self._infer_discriminator_values_for_model_choice(choice, source_name=source_name)
           ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
        choice     = {'computed_fields': [],
 'fields': {'additional_kwargs': {'metadata': {},
                                  'schema': {'default_factory': &lt;class 'dict'&gt;,
                                             'default_factory_takes_data': False,
                                             'schema': {'keys_schema': {'type': 'any'},
                                                        'type': 'dict',
                                                        'values_schema': {'type': 'any'}},
                                             'type': 'default'},
                                  'type': 'model-field'},
            'content': {'metadata': {},
                        'schema': {'choices': [{'type': 'str'},
                                               {'items_schema': {'choices': [{'type': 'str'},
                                                                             {'keys_schema': {'type': 'any'},
                                                                              'type': 'dict',
                                                                              'values_schema': {'type': 'any'}}],
                                                                 'type': 'union'},
                                                'type': 'list'}],
                                   'type': 'union'},
                        'type': 'model-field'},
            'id': {'metadata': {},
                   'schema': {'default': None,
                              'schema': {'schema': {'coerce_numbers_to_str': True,
                                                    'type': 'str'},
                                         'type': 'nullable'},
                              'type': 'default'},
                   'type': 'model-field'},
            'invalid_tool_calls': {'metadata': {},
                                   'schema': {'default': [],
                                              'schema': {'items_schema': {'cls': &lt;class 'langchain_core.messages.content.InvalidToolCall'&gt;,
                                                                          'computed_fields': [],
                                                                          'config': {'extra_fields_behavior': 'allow',
                                                                                     'title': 'InvalidToolCall'},
                                                                          'extra_behavior': 'allow',
                                                                          'fields': {'args': {'metadata': {},
                                                                                              'required': True,
                                                                                              'schema': {'schema': {'type': 'str'},
                                                                                                         'type': 'nullable'},
                                                                                              'type': 'typed-dict-field'},
                                                                                     'error': {'metadata': {},
                                                                                               'required': True,
                                                                                               'schema': {'schema': {'type': 'str'},
                                                                                                          'type': 'nullable'},
                                                                                               'type': 'typed-dict-field'},
                                                                                     'extras': {'metadata': {},
                                                                                                'required': False,
                                                                                                'schema': {'keys_schema': {'type': 'str'},
                                                                                                           'type': 'dict',
                                                                                                           'values_schema': {'type': 'any'}},
                                                                                                'type': 'typed-dict-field'},
                                                                                     'id': {'metadata': {},
                                                                                            'required': True,
                                                                                            'schema': {'schema': {'type': 'str'},
                                                                                                       'type': 'nullable'},
                                                                                            'type': 'typed-dict-field'},
                                                                                     'index': {'metadata': {},
                                                                                               'required': False,
                                                                                               'schema': {'choices': [{'type': 'int'},
                                                                                                                      {'type': 'str'}],
                                                                                                          'type': 'union'},
                                                                                               'type': 'typed-dict-field'},
                                                                                     'name': {'metadata': {},
                                                                                              'required': True,
                                                                                              'schema': {'schema': {'type': 'str'},
                                                                                                         'type': 'nullable'},
                                                                                              'type': 'typed-dict-field'},
                                                                                     'type': {'metadata': {},
                                                                                              'required': True,
                                                                                              'schema': {'expected': ['invalid_tool_call'],
                                                                                                         'type': 'literal'},
                                                                                              'type': 'typed-dict-field'}},
                                                                          'ref': 'langchain_core.messages.content.InvalidToolCall:1597346642640',
                                                                          'type': 'typed-dict'},
                                                         'type': 'list'},
                                              'type': 'default'},
                                   'type': 'model-field'},
            'name': {'metadata': {},
                     'schema': {'default': None,
                                'schema': {'schema': {'type': 'str'},
                                           'type': 'nullable'},
                                'type': 'default'},
                     'type': 'model-field'},
            'response_metadata': {'metadata': {},
                                  'schema': {'default_factory': &lt;class 'dict'&gt;,
                                             'default_factory_takes_data': False,
                                             'schema': {'keys_schema': {'type': 'any'},
                                                        'type': 'dict',
                                                        'values_schema': {'type': 'any'}},
                                             'type': 'default'},
                                  'type': 'model-field'},
            'tool_calls': {'metadata': {},
                           'schema': {'default': [],
                                      'schema': {'items_schema': {'cls': &lt;class 'langchain_core.messages.tool.ToolCall'&gt;,
                                                                  'computed_fields': [],
                                                                  'config': {'extra_fields_behavior': 'allow',
                                                                             'title': 'ToolCall'},
                                                                  'extra_behavior': 'allow',
                                                                  'fields': {'args': {'metadata': {},
                                                                                      'required': True,
                                                                                      'schema': {'keys_schema': {'type': 'str'},
                                                                                                 'type': 'dict',
                                                                                                 'values_schema': {'type': 'any'}},
                                                                                      'type': 'typed-dict-field'},
                                                                             'id': {'metadata': {},
                                                                                    'required': True,
                                                                                    'schema': {'schema': {'type': 'str'},
                                                                                               'type': 'nullable'},
                                                                                    'type': 'typed-dict-field'},
                                                                             'name': {'metadata': {},
                                                                                      'required': True,
                                                                                      'schema': {'type': 'str'},
                                                                                      'type': 'typed-dict-field'},
                                                                             'type': {'metadata': {},
                                                                                      'required': False,
                                                                                      'schema': {'expected': ['tool_call'],
                                                                                                 'type': 'literal'},
                                                                                      'type': 'typed-dict-field'}},
                                                                  'ref': 'langchain_core.messages.tool.ToolCall:1597346538480',
                                                                  'type': 'typed-dict'},
                                                 'type': 'list'},
                                      'type': 'default'},
                           'type': 'model-field'},
            'type': {'metadata': {},
                     'schema': {'default': 'ai',
                                'schema': {'expected': ['ai'],
                                           'type': 'literal'},
                                'type': 'default'},
                     'type': 'model-field'},
            'usage_metadata': {'metadata': {},
                               'schema': {'default': None,
                                          'schema': {'schema': {'cls': &lt;class 'langchain_core.messages.ai.UsageMetadata'&gt;,
                                                                'computed_fields': [],
                                                                'config': {'extra_fields_behavior': 'allow',
                                                                           'title': 'UsageMetadata'},
                                                                'extra_behavior': 'allow',
                                                                'fields': {'input_token_details': {'metadata': {},
                                                                                                   'required': False,
                                                                                                   'schema': {'cls': &lt;class 'langchain_core.messages.ai.InputTokenDetails'&gt;,
                                                                                                              'computed_fields': [],
                                                                                                              'config': {'extra_fields_behavior': 'allow',
                                                                                                                         'title': 'InputTokenDetails'},
                                                                                                              'extra_behavior': 'allow',
                                                                                                              'fields': {'audio': {'metadata': {},
                                                                                                                                   'required': False,
                                                                                                                                   'schema': {'type': 'int'},
                                                                                                                                   'type': 'typed-dict-field'},
                                                                                                                         'cache_creation': {'metadata': {},
                                                                                                                                            'required': False,
                                                                                                                                            'schema': {'type': 'int'},
                                                                                                                                            'type': 'typed-dict-field'},
                                                                                                                         'cache_read': {'metadata': {},
                                                                                                                                        'required': False,
                                                                                                                                        'schema': {'type': 'int'},
                                                                                                                                        'type': 'typed-dict-field'}},
                                                                                                              'ref': 'langchain_core.messages.ai.InputTokenDetails:1597346536496',
                                                                                                              'type': 'typed-dict'},
                                                                                                   'type': 'typed-dict-field'},
                                                                           'input_tokens': {'metadata': {},
                                                                                            'required': True,
                                                                                            'schema': {'type': 'int'},
                                                                                            'type': 'typed-dict-field'},
                                                                           'output_token_details': {'metadata': {},
                                                                                                    'required': False,
                                                                                                    'schema': {'cls': &lt;class 'langchain_core.messages.ai.OutputTokenDetails'&gt;,
                                                                                                               'computed_fields': [],
                                                                                                               'config': {'extra_fields_behavior': 'allow',
                                                                                                                          'title': 'OutputTokenDetails'},
                                                                                                               'extra_behavior': 'allow',
                                                                                                               'fields': {'audio': {'metadata': {},
                                                                                                                                    'required': False,
                                                                                                                                    'schema': {'type': 'int'},
                                                                                                                                    'type': 'typed-dict-field'},
                                                                                                                          'reasoning': {'metadata': {},
                                                                                                                                        'required': False,
                                                                                                                                        'schema': {'type': 'int'},
                                                                                                                                        'type': 'typed-dict-field'}},
                                                                                                               'ref': 'langchain_core.messages.ai.OutputTokenDetails:1597346561296',
                                                                                                               'type': 'typed-dict'},
                                                                                                    'type': 'typed-dict-field'},
                                                                           'output_tokens': {'metadata': {},
                                                                                             'required': True,
                                                                                             'schema': {'type': 'int'},
                                                                                             'type': 'typed-dict-field'},
                                                                           'total_tokens': {'metadata': {},
                                                                                            'required': True,
                                                                                            'schema': {'type': 'int'},
                                                                                            'type': 'typed-dict-field'}},
                                                                'ref': 'langchain_core.messages.ai.UsageMetadata:1597346557328',
                                                                'type': 'typed-dict'},
                                                     'type': 'nullable'},
                                          'type': 'default'},
                               'type': 'model-field'}},
 'model_name': 'AIMessage',
 'type': 'model-fields'}
        self       = &lt;pydantic._internal._discriminated_union._ApplyInferredDiscriminator object at 0x00000173EA583D90&gt;
        source_name = 'AIMessage'
..\..\AppData\Local\Programs\Python\Python313\Lib\site-packages\pydantic\_internal\_discriminated_union.py:384: in _infer_discriminator_values_for_model_choice
    raise PydanticUserError(
E   pydantic.errors.PydanticUserError: Model 'AIMessage' needs a discriminator field for key Discriminator(discriminator=&lt;function _get_type at 0x00000173EADB7D80&gt;, custom_error_type=None, custom_error_message=None, custom_error_context=None)
E   
E   For further information visit https://errors.pydantic.dev/2.12/u/discriminator-no-field
        choice     = {'computed_fields': [],
 'fields': {'additional_kwargs': {'metadata': {},
                                  'schema': {'default_factory': &lt;class 'dict'&gt;,
                                             'default_factory_takes_data': False,
                                             'schema': {'keys_schema': {'type': 'any'},
                                                        'type': 'dict',
                                                        'values_schema': {'type': 'any'}},
                                             'type': 'default'},
                                  'type': 'model-field'},
            'content': {'metadata': {},
                        'schema': {'choices': [{'type': 'str'},
                                               {'items_schema': {'choices': [{'type': 'str'},
                                                                             {'keys_schema': {'type': 'any'},
                                                                              'type': 'dict',
                                                                              'values_schema': {'type': 'any'}}],
                                                                 'type': 'union'},
                                                'type': 'list'}],
                                   'type': 'union'},
                        'type': 'model-field'},
            'id': {'metadata': {},
                   'schema': {'default': None,
                              'schema': {'schema': {'coerce_numbers_to_str': True,
                                                    'type': 'str'},
                                         'type': 'nullable'},
                              'type': 'default'},
                   'type': 'model-field'},
            'invalid_tool_calls': {'metadata': {},
                                   'schema': {'default': [],
                                              'schema': {'items_schema': {'cls': &lt;class 'langchain_core.messages.content.InvalidToolCall'&gt;,
                                                                          'computed_fields': [],
                                                                          'config': {'extra_fields_behavior': 'allow',
                                                                                     'title': 'InvalidToolCall'},
                                                                          'extra_behavior': 'allow',
                                                                          'fields': {'args': {'metadata': {},
                                                                                              'required': True,
                                                                                              'schema': {'schema': {'type': 'str'},
                                                                                                         'type': 'nullable'},
                                                                                              'type': 'typed-dict-field'},
                                                                                     'error': {'metadata': {},
                                                                                               'required': True,
                                                                                               'schema': {'schema': {'type': 'str'},
                                                                                                          'type': 'nullable'},
                                                                                               'type': 'typed-dict-field'},
                                                                                     'extras': {'metadata': {},
                                                                                                'required': False,
                                                                                                'schema': {'keys_schema': {'type': 'str'},
                                                                                                           'type': 'dict',
                                                                                                           'values_schema': {'type': 'any'}},
                                                                                                'type': 'typed-dict-field'},
                                                                                     'id': {'metadata': {},
                                                                                            'required': True,
                                                                                            'schema': {'schema': {'type': 'str'},
                                                                                                       'type': 'nullable'},
                                                                                            'type': 'typed-dict-field'},
                                                                                     'index': {'metadata': {},
                                                                                               'required': False,
                                                                                               'schema': {'choices': [{'type': 'int'},
                                                                                                                      {'type': 'str'}],
                                                                                                          'type': 'union'},
                                                                                               'type': 'typed-dict-field'},
                                                                                     'name': {'metadata': {},
                                                                                              'required': True,
                                                                                              'schema': {'schema': {'type': 'str'},
                                                                                                         'type': 'nullable'},
                                                                                              'type': 'typed-dict-field'},
                                                                                     'type': {'metadata': {},
                                                                                              'required': True,
                                                                                              'schema': {'expected': ['invalid_tool_call'],
                                                                                                         'type': 'literal'},
                                                                                              'type': 'typed-dict-field'}},
                                                                          'ref': 'langchain_core.messages.content.InvalidToolCall:1597346642640',
                                                                          'type': 'typed-dict'},
                                                         'type': 'list'},
                                              'type': 'default'},
                                   'type': 'model-field'},
            'name': {'metadata': {},
                     'schema': {'default': None,
                                'schema': {'schema': {'type': 'str'},
                                           'type': 'nullable'},
                                'type': 'default'},
                     'type': 'model-field'},
            'response_metadata': {'metadata': {},
                                  'schema': {'default_factory': &lt;class 'dict'&gt;,
                                             'default_factory_takes_data': False,
                                             'schema': {'keys_schema': {'type': 'any'},
                                                        'type': 'dict',
                                                        'values_schema': {'type': 'any'}},
                                             'type': 'default'},
                                  'type': 'model-field'},
            'tool_calls': {'metadata': {},
                           'schema': {'default': [],
                                      'schema': {'items_schema': {'cls': &lt;class 'langchain_core.messages.tool.ToolCall'&gt;,
                                                                  'computed_fields': [],
                                                                  'config': {'extra_fields_behavior': 'allow',
                                                                             'title': 'ToolCall'},
                                                                  'extra_behavior': 'allow',
                                                                  'fields': {'args': {'metadata': {},
                                                                                      'required': True,
                                                                                      'schema': {'keys_schema': {'type': 'str'},
                                                                                                 'type': 'dict',
                                                                                                 'values_schema': {'type': 'any'}},
                                                                                      'type': 'typed-dict-field'},
                                                                             'id': {'metadata': {},
                                                                                    'required': True,
                                                                                    'schema': {'schema': {'type': 'str'},
                                                                                               'type': 'nullable'},
                                                                                    'type': 'typed-dict-field'},
                                                                             'name': {'metadata': {},
                                                                                      'required': True,
                                                                                      'schema': {'type': 'str'},
                                                                                      'type': 'typed-dict-field'},
                                                                             'type': {'metadata': {},
                                                                                      'required': False,
                                                                                      'schema': {'expected': ['tool_call'],
                                                                                                 'type': 'literal'},
                                                                                      'type': 'typed-dict-field'}},
                                                                  'ref': 'langchain_core.messages.tool.ToolCall:1597346538480',
                                                                  'type': 'typed-dict'},
                                                 'type': 'list'},
                                      'type': 'default'},
                           'type': 'model-field'},
            'type': {'metadata': {},
                     'schema': {'default': 'ai',
                                'schema': {'expected': ['ai'],
                                           'type': 'literal'},
                                'type': 'default'},
                     'type': 'model-field'},
            'usage_metadata': {'metadata': {},
                               'schema': {'default': None,
                                          'schema': {'schema': {'cls': &lt;class 'langchain_core.messages.ai.UsageMetadata'&gt;,
                                                                'computed_fields': [],
                                                                'config': {'extra_fields_behavior': 'allow',
                                                                           'title': 'UsageMetadata'},
                                                                'extra_behavior': 'allow',
                                                                'fields': {'input_token_details': {'metadata': {},
                                                                                                   'required': False,
                                                                                                   'schema': {'cls': &lt;class 'langchain_core.messages.ai.InputTokenDetails'&gt;,
                                                                                                              'computed_fields': [],
                                                                                                              'config': {'extra_fields_behavior': 'allow',
                                                                                                                         'title': 'InputTokenDetails'},
                                                                                                              'extra_behavior': 'allow',
                                                                                                              'fields': {'audio': {'metadata': {},
                                                                                                                                   'required': False,
                                                                                                                                   'schema': {'type': 'int'},
                                                                                                                                   'type': 'typed-dict-field'},
                                                                                                                         'cache_creation': {'metadata': {},
                                                                                                                                            'required': False,
                                                                                                                                            'schema': {'type': 'int'},
                                                                                                                                            'type': 'typed-dict-field'},
                                                                                                                         'cache_read': {'metadata': {},
                                                                                                                                        'required': False,
                                                                                                                                        'schema': {'type': 'int'},
                                                                                                                                        'type': 'typed-dict-field'}},
                                                                                                              'ref': 'langchain_core.messages.ai.InputTokenDetails:1597346536496',
                                                                                                              'type': 'typed-dict'},
                                                                                                   'type': 'typed-dict-field'},
                                                                           'input_tokens': {'metadata': {},
                                                                                            'required': True,
                                                                                            'schema': {'type': 'int'},
                                                                                            'type': 'typed-dict-field'},
                                                                           'output_token_details': {'metadata': {},
                                                                                                    'required': False,
                                                                                                    'schema': {'cls': &lt;class 'langchain_core.messages.ai.OutputTokenDetails'&gt;,
                                                                                                               'computed_fields': [],
                                                                                                               'config': {'extra_fields_behavior': 'allow',
                                                                                                                          'title': 'OutputTokenDetails'},
                                                                                                               'extra_behavior': 'allow',
                                                                                                               'fields': {'audio': {'metadata': {},
                                                                                                                                    'required': False,
                                                                                                                                    'schema': {'type': 'int'},
                                                                                                                                    'type': 'typed-dict-field'},
                                                                                                                          'reasoning': {'metadata': {},
                                                                                                                                        'required': False,
                                                                                                                                        'schema': {'type': 'int'},
                                                                                                                                        'type': 'typed-dict-field'}},
                                                                                                               'ref': 'langchain_core.messages.ai.OutputTokenDetails:1597346561296',
                                                                                                               'type': 'typed-dict'},
                                                                                                    'type': 'typed-dict-field'},
                                                                           'output_tokens': {'metadata': {},
                                                                                             'required': True,
                                                                                             'schema': {'type': 'int'},
                                                                                             'type': 'typed-dict-field'},
                                                                           'total_tokens': {'metadata': {},
                                                                                            'required': True,
                                                                                            'schema': {'type': 'int'},
                                                                                            'type': 'typed-dict-field'}},
                                                                'ref': 'langchain_core.messages.ai.UsageMetadata:1597346557328',
                                                                'type': 'typed-dict'},
                                                     'type': 'nullable'},
                                          'type': 'default'},
                               'type': 'model-field'}},
 'model_name': 'AIMessage',
 'type': 'model-fields'}
        field      = None
        self       = &lt;pydantic._internal._discriminated_union._ApplyInferredDiscriminator object at 0x00000173EA583D90&gt;
        source     = "Model 'AIMessage'"
        source_name = 'AIMessage'</error></testcase></testsuite></testsuites>